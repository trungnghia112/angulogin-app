# üè• Audit Report - 2026-02-18

**D·ª± √°n:** Chrome Profile Manager  
**Stack:** Angular 21 + Tauri + Firebase + PrimeNG  
**B√°c sƒ©:** Khang - Security Engineer

---

## Summary

| M·ª©c ƒë·ªô | S·ªë l∆∞·ª£ng |
|--------|----------|
| üî¥ Critical Issues | 2 |
| üü° Warnings | 4 |
| üü¢ Suggestions | 5 |

**T·ªïng k·∫øt nhanh:** D·ª± √°n c√≥ n·ªÅn t·∫£ng b·∫£o m·∫≠t t·ªët (Firestore rules ch·∫∑t ch·∫Ω, .env ƒë∆∞·ª£c gitignore, kh√¥ng XSS). V·∫•n ƒë·ªÅ ch√≠nh n·∫±m ·ªü **m·∫≠t kh·∫©u proxy l∆∞u tr·∫ßn** trong localStorage v√† **component kh·ªïng l·ªì** c·∫ßn t√°ch nh·ªè.

---

## üî¥ Critical Issues (Ph·∫£i s·ª≠a ngay)

### 1. M·∫≠t kh·∫©u proxy l∆∞u d·∫°ng plaintext trong localStorage

- **File:** [proxy.service.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/services/proxy.service.ts#L186-L212)
- **Nguy hi·ªÉm:** B·∫•t k·ª≥ extension Chrome n√†o ho·∫∑c script JavaScript n√†o c≈©ng c√≥ th·ªÉ ƒë·ªçc `localStorage` v√† l·∫•y to√†n b·ªô m·∫≠t kh·∫©u proxy c·ªßa anh. N·∫øu c√≥ XSS vulnerability trong t∆∞∆°ng lai, hacker l·∫•y ƒë∆∞·ª£c h·∫øt credentials proxy.
- **Chi ti·∫øt:** `ProxyService.saveToStorage()` l∆∞u to√†n b·ªô proxy list (bao g·ªìm `username` v√† `password`) v√†o `localStorage` d∆∞·ªõi key `chrome-profile-manager-proxies` m√† KH√îNG m√£ h√≥a.
- **C√°ch s·ª≠a:**
  1. D√πng Tauri's secure store (ho·∫∑c OS keychain) ƒë·ªÉ l∆∞u credentials thay v√¨ localStorage
  2. N·∫øu ph·∫£i d√πng localStorage, m√£ h√≥a password tr∆∞·ªõc khi l∆∞u (encrypt/decrypt)
  3. T·ªëi thi·ªÉu: kh√¥ng l∆∞u password v√†o localStorage, ch·ªâ l∆∞u host/port

### 2. Functions directory l√† boilerplate tr·ªëng v·ªõi Genkit dependencies kh√¥ng d√πng

- **File:** [functions/src/index.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/functions/src/index.ts), [functions/package.json](file:///Volumes/DataMac/dev/chrome-profile-manager/functions/package.json)
- **Nguy hi·ªÉm:** 
  - `@genkit-ai/firebase`, `@genkit-ai/google-genai`, `genkit` - 3 AI dependencies n·∫∑ng, chi·∫øm h√†ng trƒÉm MB node_modules nh∆∞ng **kh√¥ng c√≥ function n√†o ƒë∆∞·ª£c export**
  - `express` dependency c≈©ng kh√¥ng d√πng
  - Deploy functions s·∫Ω t·∫£i code r·ªóng l√™n, t·ªën th·ªùi gian build
- **C√°ch s·ª≠a:**
  1. X√≥a h·∫øt unused deps: `@genkit-ai/firebase`, `@genkit-ai/google-genai`, `genkit`, `express`
  2. N·∫øu kh√¥ng d√πng Cloud Functions, x√≥a lu√¥n `functions/` directory v√† config trong `firebase.json`

---

## üü° Warnings (N√™n s·ª≠a)

### 1. God Component: `home.ts` - 1952 d√≤ng, 90+ methods

- **File:** [home.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/home/home.ts)
- **V·∫•n ƒë·ªÅ:** Component n√†y ƒëang l√†m QU√Å NHI·ªÄU vi·ªác: profiles CRUD, folders, templates, bulk operations, cookies import/export, proxy rotation, sorting/pagination, selection management, keyboard shortcuts...
- **H·∫≠u qu·∫£:** Kh√≥ b·∫£o tr√¨, kh√≥ debug, kh√≥ test. Th√™m t√≠nh nƒÉng m·ªõi s·∫Ω ng√†y c√†ng r·ªßi ro v√¨ ·∫£nh h∆∞·ªüng ch√©o.
- **C√°ch s·ª≠a:** T√°ch th√†nh sub-components:
  - `ProfileListComponent` - hi·ªÉn th·ªã + sort/filter/pagination
  - `ProfileActionsService` - launch, delete, rename, duplicate
  - `BulkOperationsComponent` - bulk launch/delete/tag
  - `CookieManagerComponent` - import/export cookies
  - `FolderManagerComponent` - folder CRUD
  - `TemplateManagerComponent` - template CRUD

### 2. `console.log` tr·ª±c ti·∫øp trong production code

- **File:** [profile.service.ts:33](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/services/profile.service.ts#L33)
- **V·∫•n ƒë·ªÅ:** `console.log(\`[PERF] scanProfiles: ${profiles.length} profiles loaded\`)` - d√πng `console.log` raw thay v√¨ `debugLog` utility
- **H·∫≠u qu·∫£:** Log s·∫Ω hi·ªán trong production builds, l·ªô th√¥ng tin n·ªôi b·ªô
- **C√°ch s·ª≠a:** Thay b·∫±ng `debugLog('PERF', 'scanProfiles:', profiles.length, 'profiles loaded')` - utility ƒë√£ c√≥ s·∫µn t·∫°i `core/utils/logger.util.ts`

### 3. Mock data imported trong production builds

- **File:** [proxy.service.ts:3](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/services/proxy.service.ts#L3)
- **V·∫•n ƒë·ªÅ:** `import { MOCK_PROXIES } from '../mocks/profile.mock'` - file mock (~9KB) ƒë∆∞·ª£c import vƒ©nh vi·ªÖn v√†o bundle d√π ch·ªâ d√πng khi `isWebDevMode()` tr·∫£ `true`
- **H·∫≠u qu·∫£:** Production bundle ch·ª©a d·ªØ li·ªáu mock kh√¥ng c·∫ßn thi·∫øt ‚Üí tƒÉng k√≠ch th∆∞·ªõc download
- **C√°ch s·ª≠a:** D√πng dynamic import: `const { MOCK_PROXIES } = await import('../mocks/profile.mock')` ch·ªâ khi c·∫ßn, ho·∫∑c t√°ch mock v√†o dev environment

### 4. S·ª≠ d·ª•ng `any` type

- **File:** [settings.ts:172-174](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/settings/settings.ts#L172-L174)
- **V·∫•n ƒë·ªÅ:** 2 ch·ªó d√πng `any` type: `value?: any` trong parameter v√† `let value: any` 
- **H·∫≠u qu·∫£:** M·∫•t type-safety, kh√≥ ph√°t hi·ªán bug t·∫°i compile time
- **C√°ch s·ª≠a:** Thay b·∫±ng union type c·ª• th·ªÉ: `boolean | string | number`

---

## üü¢ Suggestions (T√πy ch·ªçn)

### 1. `settings.ts` c≈©ng ƒëang ph√¨nh to (615 d√≤ng)

- **File:** [settings.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/settings/settings.ts)
- **G·ª£i √Ω:** T√°ch logic backup/restore, proxy management, theme settings th√†nh c√°c service ho·∫∑c sub-component ri√™ng

### 2. Subscription trong `pages.ts` n√™n d√πng `takeUntilDestroyed()`

- **File:** [pages.ts:40](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/pages.ts#L40)
- **G·ª£i √Ω:** ƒêang unsubscribe th·ªß c√¥ng (`this.routeSub?.unsubscribe()`). C√≥ th·ªÉ d√πng `takeUntilDestroyed()` cho g·ªçn v√† an to√†n h∆°n

### 3. npm audit: Moderate vulnerabilities

- **V·∫•n ƒë·ªÅ:** `ajv` dependency qua `@angular-devkit/core` b√°o moderate severity
- **G·ª£i √Ω:** ƒê√¢y l√† devDependency, kh√¥ng ·∫£nh h∆∞·ªüng production. S·∫Ω t·ª± fix khi Angular team c·∫≠p nh·∫≠t. Kh√¥ng c·∫ßn h√†nh ƒë·ªông

### 4. `@angular/fire` ƒëang ·ªü RC version

- **File:** [package.json:60](file:///Volumes/DataMac/dev/chrome-profile-manager/package.json#L60)
- **V·∫•n ƒë·ªÅ:** `"@angular/fire": "^21.0.0-rc.0"` - ƒëang d√πng Release Candidate
- **G·ª£i √Ω:** Theo d√µi v√† c·∫≠p nh·∫≠t l√™n stable khi c√≥. RC c√≥ th·ªÉ c√≥ API breaking changes

### 5. Thi·∫øu CSP (Content Security Policy) headers cho hosting

- **File:** [firebase.json](file:///Volumes/DataMac/dev/chrome-profile-manager/firebase.json)
- **G·ª£i √Ω:** Th√™m security headers v√†o Firebase Hosting config:
  ```json
  "headers": [{
    "source": "**",
    "headers": [{
      "key": "X-Content-Type-Options",
      "value": "nosniff"
    }, {
      "key": "X-Frame-Options",
      "value": "DENY"
    }]
  }]
  ```

---

## ‚úÖ Nh·ªØng ƒëi·ªÉm T·ªêT

| H·∫°ng m·ª•c | ƒê√°nh gi√° |
|----------|----------|
| Firestore Rules | ‚úÖ Ownership-based, deny-all default |
| Storage Rules | ‚úÖ Deny all (ƒëang ch·∫∑n ho√†n to√†n) |
| `.env` in `.gitignore` | ‚úÖ Kh√¥ng l·ªô secrets |
| No innerHTML/XSS | ‚úÖ Kh√¥ng d√πng `innerHTML` hay bypass security |
| Lazy loading routes | ‚úÖ T·∫•t c·∫£ routes ƒë·ªÅu lazy-loaded |
| `debugLog` utility | ‚úÖ C√≥ s·∫µn, ch·ªâ log ·ªü dev mode |
| No TODO/FIXME b·ªã b·ªè qu√™n | ‚úÖ S·∫°ch |
| GlobalErrorHandler | ‚úÖ C√≥ handler l·ªói to√†n c·ª•c |
| Zoneless Change Detection | ‚úÖ D√πng signals + zoneless (modern Angular) |
| Input validation (proxy) | ‚úÖ `validateHost()` ki·ªÉm tra k√Ω t·ª± nguy hi·ªÉm |
| Firebase API key | ‚úÖ ƒê√¢y l√† web SDK key, an to√†n khi public (b·∫£o m·∫≠t b·∫±ng Security Rules) |

---

## Next Steps

D·ª±a tr√™n k·∫øt qu·∫£ audit, ƒë√¢y l√† th·ª© t·ª± ∆∞u ti√™n s·ª≠a:

1. üî¥ **M√£ h√≥a proxy passwords** - B·∫£o m·∫≠t credentials ngay
2. üî¥ **D·ªçn functions/ boilerplate** - Gi·∫£m bloat, tr√°nh deploy code r·ªóng
3. üü° **Chuy·ªÉn console.log ‚Üí debugLog** - Fix nhanh 1 d√≤ng
4. üü° **Dynamic import cho mock data** - Gi·∫£m bundle size
5. üü° **T√°ch home.ts** - C·∫ßn plan k·ªπ, th·ª±c hi·ªán d·∫ßn (refactor l·ªõn)
