# Audit Report - 2026-02-18

**Scope:** Features 3.4 (Extensions Toggle), 10.4 (Multi-drive), 5.7 (Backup Encryption), 13.3 (Traffic Stats), 13.1 (Local Proxy Server)

## Summary
- ğŸ”´ Critical Issues: 2
- ğŸŸ¡ Warnings: 3
- ğŸŸ¢ Suggestions: 2

---

## ğŸ”´ Critical Issues (Pháº£i sá»­a ngay)

### 1. Derived encryption key not zeroed after use
- **File:** `src-tauri/src/commands.rs` (lines 978-979, 1013-1014)
- **Feature:** 5.7 (Backup Encryption)
- **Nguy hiá»ƒm:** Sau khi mÃ£ hÃ³a/giáº£i mÃ£ xong, key (máº­t kháº©u Ä‘Ã£ biáº¿n Ä‘á»•i) váº«n náº±m trong bá»™ nhá»› (RAM). Náº¿u hacker lÃ m memory dump, há» cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c key nÃ y vÃ  giáº£i mÃ£ toÃ n bá»™ backup.
- **CÃ¡ch sá»­a:** DÃ¹ng `zeroize` crate Ä‘á»ƒ xÃ³a key sau khi dÃ¹ng xong:
  ```rust
  # Cargo.toml
  zeroize = "1"

  # commands.rs
  use zeroize::Zeroize;
  // After encryption/decryption:
  key.zeroize();
  ```

### 2. `start_local_proxy` thiáº¿u validation cho `proxy_host`
- **File:** `src-tauri/src/commands.rs` (lines 1603-1624)
- **Feature:** 13.1 (Local Proxy Server)
- **Nguy hiá»ƒm:** HÃ m `start_local_proxy` nháº­n `proxy_host` tá»« frontend mÃ  khÃ´ng validate. Káº» táº¥n cÃ´ng cÃ³ thá»ƒ truyá»n domain/IP ná»™i bá»™ (SSRF) hoáº·c chuá»—i chá»©a kÃ½ tá»± Ä‘áº·c biá»‡t Ä‘á»ƒ gÃ¢y lá»—i.
- **CÃ¡ch sá»­a:** ThÃªm validation cÆ¡ báº£n cho hostname:
  ```rust
  fn validate_proxy_host(host: &str) -> Result<(), String> {
      if host.trim().is_empty() {
          return Err("Proxy host cannot be empty".to_string());
      }
      if host.contains(char::is_whitespace) || host.contains('\0') {
          return Err("Proxy host contains invalid characters".to_string());
      }
      if host.len() > 253 {
          return Err("Proxy host too long".to_string());
      }
      Ok(())
  }
  ```

---

## ğŸŸ¡ Warnings (NÃªn sá»­a)

### 3. `check_backup_encrypted` Ä‘á»c toÃ n bá»™ file chá»‰ Ä‘á»ƒ kiá»ƒm tra 8 byte Ä‘áº§u
- **File:** `src-tauri/src/commands.rs` (lines 1025-1031)
- **Feature:** 5.7 (Backup Encryption)
- **Háº­u quáº£:** Náº¿u file backup náº·ng 2GB, hÃ m sáº½ load 2GB vÃ o RAM chá»‰ Ä‘á»ƒ Ä‘á»c 8 byte header. Tá»‘n bá»™ nhá»› vÃ  cháº­m.
- **CÃ¡ch sá»­a:** Chá»‰ Ä‘á»c 8 byte Ä‘áº§u:
  ```rust
  pub fn check_backup_encrypted(backup_path: String) -> Result<bool, String> {
      validate_path_safety(&backup_path, "Backup path")?;
      let mut file = fs::File::open(&backup_path)
          .map_err(|e| format!("Failed to open file: {}", e))?;
      let mut header = [0u8; 8];
      use std::io::Read;
      match file.read_exact(&mut header) {
          Ok(_) => Ok(&header == ENCRYPTED_MAGIC),
          Err(_) => Ok(false),
      }
  }
  ```

### 4. Traffic stats map tÄƒng liÃªn tá»¥c, khÃ´ng bao giá» cleanup
- **File:** `src-tauri/src/proxy_relay.rs` (lines 28-85)
- **Feature:** 13.3 (Traffic Stats)
- **Háº­u quáº£:** Má»—i profile_id má»›i sáº½ táº¡o entry trong HashMap mÃ  khÃ´ng bao giá» xÃ³a. Sau thá»i gian dÃ i dÃ¹ng app, map sáº½ to lÃªn.
- **CÃ¡ch sá»­a:** ThÃªm cleanup khi relay dá»«ng:
  ```rust
  // In stop_relay(), add:
  traffic_stats().lock().unwrap().remove(profile_id);
  ```

### 5. `addAdditionalPath` thiáº¿u persistence call
- **File:** `src/app/core/services/settings.service.ts` (lines 279-294)
- **Feature:** 10.4 (Multi-drive)
- **Háº­u quáº£:** `addAdditionalPath` vÃ  `removeAdditionalPath` chá»‰ update signal, **khÃ´ng gá»i `saveSettings()`**. Náº¿u user add path rá»“i Ä‘Ã³ng app, path sáº½ biáº¿n máº¥t.
- **CÃ¡ch sá»­a:** ThÃªm `this.saveSettings()` vÃ o cuá»‘i cáº£ 2 hÃ m.

---

## ğŸŸ¢ Suggestions (TÃ¹y chá»n)

### 6. `scanMultiplePaths` scan tuáº§n tá»±, nÃªn scan song song
- **File:** `src/app/services/profile.service.ts` (lines 46-64)
- **Feature:** 10.4 (Multi-drive)
- **Gá»£i Ã½:** DÃ¹ng `Promise.allSettled` Ä‘á»ƒ scan song song thay vÃ¬ vÃ²ng for tuáº§n tá»±.

### 7. Feature 3.4 nÃªn hiá»‡n badge khi extensions bá»‹ táº¯t
- **Feature:** 3.4 (Extensions Toggle)
- **Gá»£i Ã½:** ThÃªm icon nhá» (e.g., `pi pi-ban`) bÃªn cáº¡nh tÃªn profile trong list khi `disableExtensions: true`.

---

## Next Steps

TÃ¬m tháº¥y **2 lá»—i nghiÃªm trá»ng** + **1 bug máº¥t data** cáº§n sá»­a ngay.
