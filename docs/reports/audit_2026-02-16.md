# Audit Report ‚Äî 2026-02-16

## Summary

| Severity | Count |
|----------|-------|
| üî¥ Critical | 0 |
| üü° Warning | 5 |
| üü¢ Suggestion | 6 |

**T·ªïng quan:** Codebase kh√° s·∫°ch. Kh√¥ng c√≥ l·ªói b·∫£o m·∫≠t nghi√™m tr·ªçng. C√°c v·∫•n ƒë·ªÅ ch√≠nh l√† code quality (God component, console logs th·ª´a) v√† dependency vulnerabilities c·∫ßn update.

---

## üî¥ Critical Issues (0)

Kh√¥ng c√≥. üëè

---

## üü° Warnings (N√™n s·ª≠a)

### W1. npm Dependencies c√≥ Known Vulnerabilities

| Package | Severity | M√¥ t·∫£ |
|---------|----------|-------|
| `@angular/cli` (via `@modelcontextprotocol/sdk`) | **HIGH** | Cross-client data leak qua shared server/transport (CVSS 7.1) |
| `@modelcontextprotocol/sdk` | **HIGH** | Race condition cho ph√©p leak data gi·ªØa c√°c clients |
| `qs` | Low | Bypass gi·ªõi h·∫°n array b·∫±ng comma parsing ‚Üí DoS |

- **File:** `package.json` ‚Üí devDependencies
- **H·∫≠u qu·∫£:** Vulnerability trong `@angular/cli` ch·ªâ ·∫£nh h∆∞·ªüng dev-time (kh√¥ng deploy l√™n production), nh∆∞ng v·∫´n n√™n update.
- **C√°ch s·ª≠a:** `npm audit fix` ho·∫∑c `npm update @angular/cli`

---

### W2. God Component: `home.ts` ‚Äî 1633 d√≤ng

- **File:** [home.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/home/home.ts)
- **H·∫≠u qu·∫£:** File qu√° l·ªõn ‚Üí kh√≥ maintain, d·ªÖ conflict khi nhi·ªÅu ng∆∞·ªùi code, kh√≥ test.
- **C√°ch s·ª≠a:** T√°ch th√†nh c√°c service/component nh·ªè h∆°n:
  - `ProfileActionsService` (create, rename, delete, duplicate ‚Üí ~200 d√≤ng)
  - `BulkOperationsService` (bulk delete, bulk export ‚Üí ~150 d√≤ng)
  - `ProfileLaunchService` (launch logic, proxy rotation ‚Üí ~100 d√≤ng)

---

### W3. console.time/timeEnd trong Production Code

- **File:** [home.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/home/home.ts) (lines 511-537)
- **H·∫≠u qu·∫£:** Performance logging l·ªçt v√†o production build. Kh√¥ng ·∫£nh h∆∞·ªüng b·∫£o m·∫≠t nh∆∞ng l√†m "b·∫©n" console.
- **6 d√≤ng c·∫ßn x√≥a:** `console.time(...)` v√† `console.timeEnd(...)` trong `scanProfiles()`
- **C√°ch s·ª≠a:** Chuy·ªÉn sang d√πng `logger.util.ts` (ƒë√£ c√≥ s·∫µn, ch·ªâ log ·ªü dev mode)

---

### W4. `@HostListener` vi ph·∫°m Angular coding standard

- **File:** [pages.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/views/pages/pages.ts) (line 24)
- **H·∫≠u qu·∫£:** Vi ph·∫°m project rules (GEMINI.md: "Do NOT use `@HostBinding` and `@HostListener` decorators"). Kh√¥ng ·∫£nh h∆∞·ªüng ch·ª©c nƒÉng, nh∆∞ng kh√¥ng consistent.
- **C√°ch s·ª≠a:** Chuy·ªÉn sang `host: { '(document:keydown)': 'onKeyDown($event)' }` trong `@Component`

---

### W5. Rust `commands.rs` qu√° l·ªõn (1346 d√≤ng)

- **File:** [commands.rs](file:///Volumes/DataMac/dev/chrome-profile-manager/src-tauri/src/commands.rs)
- **H·∫≠u qu·∫£:** T·∫≠p trung t·∫•t c·∫£ command v√†o 1 file ‚Üí kh√≥ navigate, kh√≥ maintain.
- **C√°ch s·ª≠a:** T√°ch th√†nh modules: `profile_commands.rs`, `browser_commands.rs`, `backup_commands.rs`, etc.

---

## üü¢ Suggestions (T√πy ch·ªçn)

### S1. Proxy credentials l∆∞u plaintext trong localStorage

- **File:** `proxy.service.ts`
- **M√¥ t·∫£:** Username/password proxy l∆∞u trong `localStorage` kh√¥ng m√£ h√≥a. ƒê√¢y l√† app desktop (Tauri) n√™n r·ªßi ro th·∫•p h∆°n web, nh∆∞ng n·∫øu ai ƒë√≥ access filesystem c√≥ th·ªÉ ƒë·ªçc.
- **G·ª£i √Ω:** D√πng Tauri's secure store ho·∫∑c OS keychain cho sensitive data.

### S2. 5 `unwrap()` calls trong Rust

- **Files:** `commands.rs` (2), `proxy_relay.rs` (3)
- **M√¥ t·∫£:** `unwrap()` c√≥ th·ªÉ panic. Trong tr∆∞·ªùng h·ª£p c·ª• th·ªÉ n√†y, c√°c unwrap ƒë·ªÅu safe do c√≥ guard check tr∆∞·ªõc. Nh∆∞ng best practice l√† d√πng `?` operator ho·∫∑c `.unwrap_or_default()`.

### S3. `eprintln!` debug logs l∆∞u l·∫°i trong Rust production

- **Files:** `commands.rs` (8 ch·ªó), `proxy_relay.rs` (24 ch·ªó)
- **M√¥ t·∫£:** Perf logs `[PERF]` v√† debug info `[ProxyRelay]` xu·∫•t ra stderr. H·ªØu √≠ch cho debug nh∆∞ng n√™n d√πng `log` crate v·ªõi level control.
- **G·ª£i √Ω:** Thay `eprintln!` b·∫±ng `log::debug!()` ho·∫∑c `log::info!()` ƒë·ªÉ ki·ªÉm so√°t qua log level.

### S4. Firebase API Key trong source code

- **Files:** `environments/environment.ts`, `environment.prod.ts`, `environment.dev.ts`
- **M√¥ t·∫£:** Firebase API key hardcoded. ƒê√¢y l√† **b√¨nh th∆∞·ªùng** cho Firebase client-side apps ‚Äî key n√†y kh√¥ng ph·∫£i secret (b·∫£o m·∫≠t qua Firebase Security Rules). Nh∆∞ng n√™n restrict key trong Firebase Console.

### S5. Mock service v·∫´n t·ªìn t·∫°i

- **File:** [profile.mock.ts](file:///Volumes/DataMac/dev/chrome-profile-manager/src/app/mocks/profile.mock.ts) (279 d√≤ng)
- **M√¥ t·∫£:** File mock data c√≥ th·ªÉ kh√¥ng c√≤n c·∫ßn thi·∫øt n·∫øu app ƒë√£ chuy·ªÉn sang Tauri backend ho√†n to√†n.

### S6. Subscription Management ‚Äî T·ªët ‚úÖ

- **ƒê√°nh gi√°:** 2 `.subscribe()` c·∫£ hai ƒë·ªÅu ƒë∆∞·ª£c cleanup ƒë√∫ng:
  - `pages.ts`: Manual `unsubscribe()` trong `ngOnDestroy`
  - `home.ts`: `takeUntilDestroyed(destroyRef)` ‚Äî Angular best practice
- `setInterval` cleanup ƒë√∫ng v·ªõi visibility API pause.
- **Kh√¥ng c·∫ßn s·ª≠a.**

---

## Security Checklist

| Ki·ªÉm tra | K·∫øt qu·∫£ |
|----------|---------|
| Hardcoded secrets | ‚úÖ Kh√¥ng c√≥ (Firebase API key l√† public) |
| Input sanitization | ‚úÖ URL scheme validation, dangerous CLI flag filtering |
| SQL/NoSQL injection | ‚úÖ N/A (d√πng Firestore SDK) |
| XSS (innerHTML, bypassSecurity) | ‚úÖ Kh√¥ng s·ª≠ d·ª•ng |
| Unsafe Rust code | ‚úÖ Kh√¥ng c√≥ `unsafe` blocks |
| .env in .gitignore | ‚úÖ C√≥ |
| TODO/FIXME b·ªè qu√™n | ‚úÖ Kh√¥ng t√¨m th·∫•y |
| Command injection prevention | ‚úÖ Flag whitelist + URL scheme check |

---

## Next Steps

1Ô∏è‚É£ `npm audit fix` ‚Äî S·ª≠a npm vulnerabilities (2 ph√∫t)
2Ô∏è‚É£ X√≥a `console.time` logs trong `home.ts` (2 ph√∫t)
3Ô∏è‚É£ Chuy·ªÉn `@HostListener` ‚Üí `host` trong `pages.ts` (2 ph√∫t)
4Ô∏è‚É£ *(D√†i h·∫°n)* T√°ch `home.ts` th√†nh components nh·ªè h∆°n
5Ô∏è‚É£ *(D√†i h·∫°n)* T√°ch `commands.rs` th√†nh modules
