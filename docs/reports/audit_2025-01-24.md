# ğŸ¥ Performance Audit Report - 2025-01-24

## Summary
- ğŸ”´ Critical Issues: 1
- ğŸŸ¡ Warnings: 2
- ğŸŸ¢ Suggestions: 1

---

## ğŸ”´ Critical Issue: setInterval gÃ¢y Re-render má»—i 10 giÃ¢y

### Váº¥n Ä‘á»
```typescript
// home.ts:190-194
this.statusInterval = setInterval(() => {
    if (this.profiles().length > 0) {
        this.profileService.refreshProfileStatus();
    }
}, 10000);
```

### âš ï¸ Táº¡i sao nguy hiá»ƒm?
**NgÃ´n ngá»¯ Ä‘á»i thÆ°á»ng:** Má»—i 10 giÃ¢y, app gá»i `refreshProfileStatus()` â†’ method nÃ y táº¡o **OBJECT Má»šI** cho TOÃ€N Bá»˜ profiles â†’ Angular detect change â†’ **RE-RENDER TOÃ€N Bá»˜ TABLE**.

```typescript
// profile.service.ts:218-226
async refreshProfileStatus(): Promise<void> {
    const current = this.profiles();
    const updated = await Promise.all(
        current.map(async (p) => ({
            ...p,  // ğŸ‘ˆ Spread táº¡o object Má»šI cho Má»–I profile
            isRunning: await this.isProfileRunning(p.path),
        }))
    );
    this.profiles.set(updated);  // ğŸ‘ˆ Set TOÃ€N Bá»˜ array má»›i
}
```

**Káº¿t quáº£:** 
- Náº¿u cÃ³ 12 profiles â†’ má»—i 10 giÃ¢y táº¡o 12 objects má»›i
- Má»—i 1 phÃºt = 6 láº§n Ã— 12 objects = 72 objects má»›i
- GÃ¢y **lag** vÃ  **memory churn** (khÃ´ng pháº£i memory leak nhÆ°ng GC pháº£i lÃ m viá»‡c nhiá»u)

### ğŸ› ï¸ CÃ¡ch sá»­a (Recommended)
Chá»‰ update nhá»¯ng profile cÃ³ thay Ä‘á»•i:

```typescript
async refreshProfileStatus(): Promise<void> {
    const current = this.profiles();
    let hasChanges = false;
    
    const updated = await Promise.all(
        current.map(async (p) => {
            const isRunning = await this.isProfileRunning(p.path);
            if (p.isRunning !== isRunning) {
                hasChanges = true;
                return { ...p, isRunning };
            }
            return p;  // ğŸ‘ˆ Giá»¯ nguyÃªn reference náº¿u khÃ´ng thay Ä‘á»•i
        })
    );
    
    if (hasChanges) {
        this.profiles.set(updated);  // ğŸ‘ˆ Chá»‰ set khi cÃ³ thay Ä‘á»•i
    }
}
```

---

## ğŸŸ¡ Warning 1: KhÃ´ng cÃ³ Getter nhÆ°ng cÃ³ Computed Signal gá»i nhiá»u láº§n

### Váº¥n Ä‘á»
CÃ¡c computed signal sau Ä‘Æ°á»£c gá»i **NHIá»€U Láº¦N** trong template:

| Signal | Sá»‘ láº§n gá»i trong template |
|--------|--------------------------|
| `hasActiveFilters()` | 3 láº§n |
| `activeFilterCount()` | 2 láº§n |
| `uniqueGroups()` | 2 láº§n |
| `filteredProfiles()` | 3 láº§n |
| `editTags()` | 3 láº§n |

### Táº¡i sao khÃ´ng critical?
Angular Signals cÃ³ **caching** tá»± Ä‘á»™ng. Computed sáº½ chá»‰ tÃ­nh láº¡i khi dependencies thay Ä‘á»•i. Tuy nhiÃªn, má»—i láº§n gá»i `()` váº«n cÃ³ overhead nhá».

### Best Practice
Náº¿u muá»‘n tá»‘i Æ°u hÆ¡n, cÃ³ thá»ƒ táº¡o biáº¿n local trong template vá»›i `@let`:
```html
@let filtered = filteredProfiles();
<!-- DÃ¹ng filtered thay vÃ¬ filteredProfiles() -->
```

---

## ğŸŸ¡ Warning 2: effect() cÃ³ thá»ƒ gÃ¢y scan profiles nhiá»u láº§n

### Váº¥n Ä‘á»
```typescript
// home.ts:183-188
effect(() => {
    const path = this.profilesPath();
    if (path) {
        this.scanProfiles();  // ğŸ‘ˆ Async operation trong effect
    }
});
```

### Táº¡i sao warning?
Effect sáº½ cháº¡y láº¡i khi `profilesPath()` thay Ä‘á»•i. Náº¿u user thay Ä‘á»•i path liÃªn tá»¥c (typing), cÃ³ thá»ƒ gÃ¢y nhiá»u láº§n scan.

### Gá»£i Ã½
ThÃªm debounce náº¿u cáº§n, hoáº·c kiá»ƒm tra path cÃ³ thá»±c sá»± thay Ä‘á»•i:
```typescript
effect(() => {
    const path = this.profilesPath();
    const prev = this.lastScannedPath;
    if (path && path !== prev) {
        this.lastScannedPath = path;
        this.scanProfiles();
    }
});
```

---

## ğŸŸ¢ Suggestion: Interval 10s cÃ³ thá»ƒ quÃ¡ ngáº¯n

### Gá»£i Ã½
10 giÃ¢y refresh status cÃ³ thá»ƒ quÃ¡ thÆ°á»ng xuyÃªn cho use case nÃ y. CÃ¢n nháº¯c:
- TÄƒng lÃªn 30-60 giÃ¢y
- Hoáº·c chá»‰ refresh khi user focus vÃ o window
- Hoáº·c dÃ¹ng visibility API Ä‘á»ƒ pause khi tab khÃ´ng active

```typescript
document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        clearInterval(this.statusInterval);
    } else {
        this.startStatusInterval();
    }
});
```

---

## âœ… Äiá»ƒm tá»‘t (KhÃ´ng cÃ³ Memory Leak)

1. **setInterval Ä‘Æ°á»£c cleanup** á»Ÿ `ngOnDestroy()` âœ…
2. **Observable subscription** dÃ¹ng `takeUntilDestroyed()` âœ…
3. **KhÃ´ng cÃ³ getter methods** trong template - táº¥t cáº£ Ä‘á»u lÃ  signals âœ…
4. **ChangeDetection: OnPush** Ä‘Æ°á»£c sá»­ dá»¥ng âœ…

---

## ğŸ“Š TÃ³m táº¯t

| Váº¥n Ä‘á» | Má»©c Ä‘á»™ | TÃ¡c Ä‘á»™ng |
|--------|--------|----------|
| refreshProfileStatus táº¡o objects má»›i | ğŸ”´ High | Re-render má»—i 10s |
| Computed gá»i nhiá»u láº§n | ğŸŸ¡ Low | Overhead nhá» |
| Effect cÃ³ thá»ƒ trigger nhiá»u láº§n | ğŸŸ¡ Low | Náº¿u path thay Ä‘á»•i |
| Interval 10s quÃ¡ ngáº¯n | ğŸŸ¢ Info | TÃ¹y use case |

---

## ğŸ”§ Action Required

**Anh tháº¥y app re-render má»—i phÃºt lÃ  ÄÃšNG** - do `setInterval` 10 giÃ¢y Ã— 6 = 60 giÃ¢y (1 phÃºt) sáº½ cÃ³ 6 láº§n refresh, má»—i láº§n Ä‘á»u táº¡o objects má»›i vÃ  trigger re-render.

**Fix chÃ­nh:** Sá»­a `refreshProfileStatus()` Ä‘á»ƒ chá»‰ update khi cÃ³ thay Ä‘á»•i thá»±c sá»±.
