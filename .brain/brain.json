{
    "meta": {
        "schema_version": "1.1.0",
        "awf_version": "4.0.0",
        "updated_at": "2026-01-26T13:56:00+07:00"
    },
    "project": {
        "name": "Chrome Profile Manager",
        "type": "desktop-app",
        "status": "active-development",
        "description": "Tauri + Angular desktop app to manage multiple Chrome profiles"
    },
    "tech_stack": {
        "frontend": {
            "framework": "Angular 20+",
            "ui_library": "PrimeNG",
            "styling": "Tailwind CSS + tailwindcss-primeui",
            "state": "Angular Signals",
            "charts": "PrimeNG Charts (Chart.js wrapper)",
            "drag_drop": "@angular/cdk DragDropModule"
        },
        "backend": {
            "runtime": "Tauri 2.x (Rust)",
            "plugins": [
                "tauri-plugin-fs",
                "tauri-plugin-shell",
                "tauri-plugin-dialog",
                "tauri-plugin-os",
                "tauri-plugin-log"
            ]
        },
        "database": {
            "type": "file-based",
            "format": "JSON metadata per profile (.profile-meta.json)"
        }
    },
    "architecture": {
        "profile_storage": {
            "managed_profiles_path": {
                "macOS": "~/Library/Application Support/ChromeProfileManager/Profiles",
                "windows": "%APPDATA%/ChromeProfileManager/Profiles",
                "linux": "~/.config/ChromeProfileManager/Profiles"
            },
            "native_chrome_path": {
                "macOS": "~/Library/Application Support/Google/Chrome",
                "windows": "%LOCALAPPDATA%/Google/Chrome/User Data",
                "linux": "~/.config/google-chrome"
            }
        },
        "profile_detection": {
            "native_profile": "Parent folder has 'Local State' file",
            "managed_profile": "No 'Local State' in parent",
            "valid_profile_check": "Has 'Preferences' file OR named 'Default'/'Profile X'"
        },
        "launch_behavior": {
            "native_profile": "--user-data-dir=<parent> --profile-directory=<folder_name>",
            "managed_profile": "--user-data-dir=<profile_path>"
        }
    },
    "key_files": {
        "rust_commands": "src-tauri/src/commands.rs",
        "tauri_config": "src-tauri/src/lib.rs",
        "settings_service": "src/app/core/services/settings.service.ts",
        "profile_service": "src/app/services/profile.service.ts",
        "home_component": "src/app/views/pages/home/home.ts",
        "storage_dashboard": "src/app/views/pages/storage-dashboard/storage-dashboard.ts",
        "activity_log_service": "src/app/services/activity-log.service.ts"
    },
    "features": [
        {
            "name": "Profile Management",
            "status": "implemented",
            "includes": [
                "scan",
                "create",
                "delete",
                "rename",
                "duplicate",
                "backup",
                "restore"
            ]
        },
        {
            "name": "Multi-Browser Support",
            "status": "implemented",
            "browsers": [
                "Chrome",
                "Brave",
                "Edge",
                "Arc"
            ]
        },
        {
            "name": "Profile Metadata",
            "status": "implemented",
            "includes": [
                "emoji",
                "notes",
                "group",
                "tags",
                "launchUrl",
                "isPinned",
                "color",
                "isHidden",
                "sortOrder",
                "isFavorite",
                "customFlags"
            ]
        },
        {
            "name": "Settings Page",
            "status": "implemented",
            "includes": [
                "Appearance (theme, colors, scale, dark mode)",
                "General (default browser, launch behavior, startup options)",
                "Browser Paths (profiles directory selection)",
                "Data Management (export, import, clear, restore from backup)"
            ]
        },
        {
            "name": "Smart Profile Detection",
            "status": "implemented",
            "description": "Auto-detect native vs managed profiles for correct launch"
        },
        {
            "name": "Storage Dashboard",
            "status": "implemented",
            "includes": [
                "storage stats cards",
                "pie chart",
                "bar chart",
                "sortable table",
                "usage statistics"
            ]
        },
        {
            "name": "Usage Statistics",
            "status": "implemented",
            "includes": [
                "launchCount",
                "totalUsageMinutes",
                "lastSessionDuration",
                "session tracking"
            ]
        },
        {
            "name": "Activity Log",
            "status": "implemented",
            "description": "Track profile launches with timestamps, saved in localStorage"
        },
        {
            "name": "Drag & Drop Reordering",
            "status": "implemented",
            "description": "Custom sort mode with drag & drop using Angular CDK"
        },
        {
            "name": "Profile Backup & Restore",
            "status": "implemented",
            "includes": [
                "export as ZIP",
                "restore from ZIP backup",
                "conflict handling"
            ]
        },
        {
            "name": "Favorites (2.4)",
            "status": "implemented",
            "description": "Mark profiles as favorites with heart icon, filter Favorites view"
        },
        {
            "name": "Custom Chrome Flags (3.6)",
            "status": "implemented",
            "description": "User-defined launch flags like --disable-gpu, saved in metadata and passed to browser"
        },
        {
            "name": "Clear Profile Cookies (4.2)",
            "status": "implemented",
            "description": "One-click delete cookies, cache, session storage, local storage, IndexedDB (14+ data types)"
        },
        {
            "name": "Compact Mode (6.7)",
            "status": "implemented",
            "description": "Toggle to display more profiles on screen (8-10 columns vs 4-5), persisted in localStorage"
        }
    ],
    "api_endpoints": [
        {
            "command": "scan_profiles",
            "description": "Quét folder và trả về danh sách profiles với size"
        },
        {
            "command": "launch_browser",
            "description": "Mở browser với profile, track usage stats, support custom flags"
        },
        {
            "command": "create_profile",
            "description": "Tạo profile mới (folder rỗng)"
        },
        {
            "command": "delete_profile",
            "description": "Xóa folder profile"
        },
        {
            "command": "duplicate_profile",
            "description": "Copy folder profile"
        },
        {
            "command": "rename_profile",
            "description": "Đổi tên folder profile"
        },
        {
            "command": "backup_profile",
            "description": "Nén profile thành file ZIP backup"
        },
        {
            "command": "restore_from_backup",
            "description": "Giải nén ZIP backup thành profile mới"
        },
        {
            "command": "save_profile_metadata",
            "description": "Lưu metadata (emoji, tags, isFavorite, customFlags...) vào .profile-meta.json"
        },
        {
            "command": "get_profile_metadata",
            "description": "Đọc metadata từ .profile-meta.json"
        },
        {
            "command": "clear_profile_cookies",
            "description": "Xóa cookies, cache, IndexedDB, session/local storage (14+ data types)"
        }
    ],
    "knowledge_items": {
        "patterns": [
            {
                "name": "Tauri 2.x Environment Detection",
                "code": "window.__TAURI_INTERNALS__ !== undefined",
                "note": "Tauri 1.x uses window.__TAURI__, Tauri 2.x uses window.__TAURI_INTERNALS__"
            },
            {
                "name": "Chrome Profile Directory Structure",
                "note": "User Data Dir contains 'Local State' + profile folders (Default, Profile 1, etc.)"
            },
            {
                "name": "Angular CDK Drag Drop",
                "code": "cdkDropList + cdkDrag directives, moveItemInArray for reorder",
                "note": "Import DragDropModule from @angular/cdk/drag-drop"
            },
            {
                "name": "PrimeNG Charts",
                "code": "<p-chart type=\"pie\" [data]=\"chartData\" [options]=\"options\" />",
                "note": "Wrapper around Chart.js, auto-installed with PrimeNG"
            },
            {
                "name": "Tailwind v4 Source Configuration",
                "code": "@import 'tailwindcss' source(none);\n@source '../src/**/*.html';\n@source '../src/**/*.ts';",
                "note": "Disable auto-detection with source(none), then explicitly define paths to prevent scanning unintended files"
            },
            {
                "name": "localStorage Signal Initialization",
                "code": "signal<boolean>(typeof localStorage !== 'undefined' && localStorage.getItem('key') === 'true')",
                "note": "Safe pattern for SSR-compatible localStorage initialization with signals"
            }
        ],
        "gotchas": [
            {
                "issue": "Using --user-data-dir with profile subfolder creates NEW profile",
                "solution": "Use --user-data-dir=<parent> --profile-directory=<folder> for native profiles"
            },
            {
                "issue": "tauri-plugin-os not working",
                "solution": "Must add to Cargo.toml, register in lib.rs, AND add 'os:default' to capabilities"
            },
            {
                "issue": "PrimeNG v21 renamed InputSwitch to ToggleSwitch",
                "solution": "import { ToggleSwitchModule } from 'primeng/toggleswitch'; use <p-toggleSwitch>"
            },
            {
                "issue": "Rust zip crate may fail on special characters in filenames",
                "solution": "Use options.set_option(zip::write::FileOptions::default().utf_encoded_filenames(true))"
            },
            {
                "issue": "CDK DragDrop in grid layout",
                "solution": "Use cdkDropListDisabled to disable when not in custom sort mode"
            },
            {
                "issue": "Tailwind v4 CSS warning: Expected identifier but found - (invalid class like [-:|])",
                "solution": "Add source(none) to @import 'tailwindcss' and explicitly define @source paths"
            },
            {
                "issue": "NG8107 warning: optional chain operator not needed",
                "solution": "Replace ?.property ?? 'fallback' with @if control flow when signal type doesn't include undefined"
            }
        ],
        "conventions": [
            "All page components MUST have host: { class: 'flex-1 flex flex-col min-h-0 overflow-hidden' }",
            "Use async/await + firstValueFrom for user actions",
            "Commit after every significant change with semantic format",
            "All surfaces need dark: variants for dark mode (bg-surface-0 dark:bg-surface-900)",
            "Use PrimeNG Charts for visualization, not raw Chart.js",
            "New features added to ProfileMetadata must be updated in: TS model, Rust struct, save_profile_metadata, and service method"
        ]
    }
}