{
    "meta": {
        "schema_version": "1.1.0",
        "awf_version": "4.1.2",
        "updated_at": "2026-02-18T11:07:00+07:00"
    },
    "project": {
        "name": "Chrome Profile Manager",
        "type": "desktop-app",
        "status": "production-ready",
        "description": "Tauri + Angular desktop app to manage multiple Chrome profiles"
    },
    "tech_stack": {
        "frontend": {
            "framework": "Angular 21",
            "ui_library": "PrimeNG",
            "styling": "Tailwind CSS + tailwindcss-primeui",
            "state": "Angular Signals",
            "charts": "PrimeNG Charts (Chart.js wrapper)",
            "drag_drop": "@angular/cdk DragDropModule"
        },
        "backend": {
            "runtime": "Tauri 2.x (Rust)",
            "plugins": [
                "tauri-plugin-fs",
                "tauri-plugin-shell",
                "tauri-plugin-dialog",
                "tauri-plugin-os",
                "tauri-plugin-log"
            ]
        },
        "database": {
            "type": "file-based",
            "format": "JSON metadata per profile (.profile-meta.json)"
        }
    },
    "architecture": {
        "profile_storage": {
            "managed_profiles_path": {
                "macOS": "~/Library/Application Support/ChromeProfileManager/Profiles",
                "windows": "%APPDATA%/ChromeProfileManager/Profiles",
                "linux": "~/.config/ChromeProfileManager/Profiles"
            },
            "native_chrome_path": {
                "macOS": "~/Library/Application Support/Google/Chrome",
                "windows": "%LOCALAPPDATA%/Google/Chrome/User Data",
                "linux": "~/.config/google-chrome"
            }
        },
        "profile_detection": {
            "native_profile": "Parent folder has 'Local State' file",
            "managed_profile": "No 'Local State' in parent",
            "valid_profile_check": "Has 'Preferences' file OR named 'Default'/'Profile X'"
        },
        "launch_behavior": {
            "native_profile": "--user-data-dir=<parent> --profile-directory=<folder_name>",
            "managed_profile": "--user-data-dir=<profile_path>"
        }
    },
    "key_files": {
        "rust_commands": "src-tauri/src/commands.rs",
        "tauri_config": "src-tauri/src/lib.rs",
        "settings_service": "src/app/core/services/settings.service.ts",
        "profile_service": "src/app/services/profile.service.ts",
        "home_component": "src/app/views/pages/home/home.ts",
        "storage_dashboard": "src/app/views/pages/storage-dashboard/storage-dashboard.ts",
        "activity_log_service": "src/app/services/activity-log.service.ts",
        "audit_tracker": "docs/FEATURE_AUDIT_TRACKER.md"
    },
    "security_audit": {
        "grade": "A-",
        "completed_at": "2026-02-12",
        "modules_audited": 47,
        "issues_found": 56,
        "issues_fixed": 37,
        "key_fixes": [
            "validate_path_safety() in Rust backend — prevents path traversal",
            "sanitizeSettings() — validates imported settings values",
            "csvSafe() — prevents CSV formula injection in exports",
            "backupInProgress/restoreInProgress signals — double-click guards",
            "setScale() bounds check — clamp 12-24px",
            "ActivityLogService load cap — Array.isArray + slice(0, MAX_ENTRIES)",
            "History file 16-byte header check instead of full file read"
        ]
    },
    "features": [
        {
            "name": "Profile Management",
            "status": "implemented",
            "includes": [
                "scan",
                "create",
                "delete",
                "rename",
                "duplicate",
                "backup",
                "restore"
            ]
        },
        {
            "name": "Multi-Browser Support",
            "status": "implemented",
            "browsers": [
                "Chrome",
                "Brave",
                "Edge",
                "Arc"
            ]
        },
        {
            "name": "Profile Metadata",
            "status": "implemented",
            "includes": [
                "emoji",
                "notes",
                "group",
                "tags",
                "launchUrl",
                "isPinned",
                "color",
                "isHidden",
                "sortOrder",
                "isFavorite",
                "customFlags"
            ]
        },
        {
            "name": "Settings Page",
            "status": "implemented",
            "includes": [
                "Appearance (theme, colors, scale, dark mode)",
                "General (default browser, launch behavior, startup options)",
                "Browser Paths (profiles directory selection)",
                "Data Management (export, import, clear, restore from backup)"
            ]
        },
        {
            "name": "Smart Profile Detection",
            "status": "implemented",
            "description": "Auto-detect native vs managed profiles for correct launch"
        },
        {
            "name": "Storage Dashboard",
            "status": "implemented",
            "includes": [
                "storage stats cards",
                "pie chart",
                "bar chart",
                "sortable table",
                "usage statistics"
            ]
        },
        {
            "name": "Usage Statistics",
            "status": "implemented",
            "includes": [
                "launchCount",
                "totalUsageMinutes",
                "lastSessionDuration",
                "session tracking"
            ]
        },
        {
            "name": "Activity Log",
            "status": "implemented",
            "description": "Track profile launches with timestamps, saved in localStorage"
        },
        {
            "name": "Drag & Drop Reordering",
            "status": "implemented",
            "description": "Custom sort mode with drag & drop using Angular CDK"
        },
        {
            "name": "Profile Backup & Restore",
            "status": "implemented",
            "includes": [
                "export as ZIP",
                "restore from ZIP backup",
                "conflict handling"
            ]
        },
        {
            "name": "Favorites (2.4)",
            "status": "implemented",
            "description": "Mark profiles as favorites with heart icon, filter Favorites view"
        },
        {
            "name": "Custom Chrome Flags (3.6)",
            "status": "implemented",
            "description": "User-defined launch flags like --disable-gpu, saved in metadata and passed to browser"
        },
        {
            "name": "Clear Profile Cookies (4.2)",
            "status": "implemented",
            "description": "One-click delete cookies, cache, session storage, local storage, IndexedDB (14+ data types)"
        },
        {
            "name": "Compact Mode (6.7)",
            "status": "implemented",
            "description": "Toggle to display more profiles on screen (8-10 columns vs 4-5), persisted in localStorage"
        },
        {
            "name": "Mobile Responsive UI",
            "status": "implemented",
            "description": "Fully responsive layout for mobile/tablet with collapsible sidebar drawer, hamburger menu, icon-only tabs, and responsive dialogs",
            "includes": [
                "Sidebar drawer with backdrop (hidden on mobile, slides in on tap)",
                "Hamburger menu button (visible only on mobile)",
                "Responsive header toolbar (icon-only buttons on mobile)",
                "Scrollable tabs with icon-only on mobile",
                "Responsive dialog widths min(Xpx, 95vw)"
            ]
        },
        {
            "name": "Proxy Management (4.x)",
            "status": "implemented",
            "includes": [
                "Proxy assignment per profile",
                "Proxy health check",
                "Proxy import/export",
                "Proxy groups by region/provider"
            ]
        },
        {
            "name": "Auto Backup (5.4)",
            "status": "implemented",
            "description": "Scheduled automatic backup with configurable intervals"
        },
        {
            "name": "Usage Heatmap (9.2)",
            "status": "implemented",
            "description": "GitHub-style yearly activity calendar showing daily usage"
        },
        {
            "name": "Profile Health Check (9.3)",
            "status": "implemented",
            "description": "Validate Chrome profile integrity - check for Preferences file, corrupted JSON, required folders"
        },
        {
            "name": "Cleanup Suggestions (9.4)",
            "status": "implemented",
            "description": "Suggest profiles to clean based on size and usage patterns"
        },
        {
            "name": "Folder Management (2.5)",
            "status": "implemented",
            "description": "Group profiles into custom folders. Includes 'Large' (>1GB) and 'Unused' (>30 days) system folders.",
            "includes": [
                "Custom Folders (Create/Edit/Delete)",
                "System Folders (Large, Unused)",
                "Profile Assignment"
            ]
        },
        {
            "name": "Launch with Extensions Toggle (3.4)",
            "status": "implemented",
            "description": "Option to launch browser with --disable-extensions flag"
        },
        {
            "name": "Proxy Rotation (4.2)",
            "status": "implemented",
            "description": "Auto-rotate proxies per_launch, hourly, or daily with proxyGroupId"
        },
        {
            "name": "Zen Mode (6.9)",
            "status": "implemented",
            "description": "Hide MainNav + Sidebar for maximum workspace. Toggle via button or ⌘+\\. Persisted in localStorage. Floating exit button."
        },
        {
            "name": "Mass Tag Assign (12.1)",
            "status": "implemented",
            "description": "Bulk tag assignment: select profiles → Tags button → choose/create tags → Apply. Merges with existing tags."
        },
        {
            "name": "Table UX Columns (11.4+11.5)",
            "status": "implemented",
            "description": "Added Last Changed (relative date) and Running Time (formatted duration) columns to profile table view."
        },
        {
            "name": "Cookie Import/Export (Sprint 1)",
            "status": "implemented",
            "description": "Export/import cookies from Chrome profile SQLite database with keychain decryption",
            "includes": [
                "Rust: AES-128-CBC decryption via Chrome keychain key",
                "Export cookies to JSON (domain, name, value, path, expiry, sameSite)",
                "Import cookies from JSON with upsert (INSERT OR REPLACE)",
                "SameSite round-trip mapping (lax/strict/none/unspecified)",
                "10MB JSON size limit, async Tauri commands",
                "Per-profile loading spinner, file size check before read"
            ]
        },
        {
            "name": "Bulk Create Profiles (Sprint 1)",
            "status": "implemented",
            "description": "Create multiple profiles at once with naming pattern",
            "includes": [
                "Prefix + count + start number inputs",
                "Zero-padded naming (Profile_001, Profile_002...)",
                "Live preview of generated names",
                "Skip existing names, max 500",
                "Toast with created/skipped/errors count"
            ]
        },
        {
            "name": "Profile Templates (Sprint 1)",
            "status": "implemented",
            "description": "Save profile as template, create new profiles from templates",
            "includes": [
                "Templates stored in _templates/ subdirectory",
                "Rust copy_profile_to for cross-directory copies",
                "Save as Template button on each profile row",
                "Create from Template dialog with template list",
                "Delete templates from list"
            ]
        }
    ],
    "api_endpoints": [
        {
            "command": "scan_profiles",
            "description": "Quét folder và trả về danh sách profiles với size"
        },
        {
            "command": "launch_browser",
            "description": "Mở browser với profile, track usage stats, support custom flags"
        },
        {
            "command": "create_profile",
            "description": "Tạo profile mới (folder rỗng)"
        },
        {
            "command": "delete_profile",
            "description": "Xóa folder profile"
        },
        {
            "command": "duplicate_profile",
            "description": "Copy folder profile"
        },
        {
            "command": "rename_profile",
            "description": "Đổi tên folder profile"
        },
        {
            "command": "backup_profile",
            "description": "Nén profile thành file ZIP backup"
        },
        {
            "command": "restore_from_backup",
            "description": "Giải nén ZIP backup thành profile mới"
        },
        {
            "command": "save_profile_metadata",
            "description": "Lưu metadata (emoji, tags, isFavorite, customFlags...) vào .profile-meta.json"
        },
        {
            "command": "get_profile_metadata",
            "description": "Đọc metadata từ .profile-meta.json"
        },
        {
            "command": "clear_profile_cookies",
            "description": "Xóa cookies, cache, IndexedDB, session/local storage (14+ data types)"
        },
        {
            "command": "check_profile_health",
            "description": "Kiểm tra integrity của profile: Preferences file, JSON validity, required folders"
        },
        {
            "command": "export_profile_cookies",
            "description": "Export cookies from Chrome Cookies SQLite DB with keychain decryption (async)"
        },
        {
            "command": "import_profile_cookies",
            "description": "Import cookies JSON into Chrome Cookies SQLite DB with upsert (async, 10MB limit)"
        },
        {
            "command": "copy_profile_to",
            "description": "Copy profile directory to specific destination path (used for templates)"
        }
    ],
    "knowledge_items": {
        "patterns": [
            {
                "name": "Tauri 2.x Environment Detection",
                "code": "window.__TAURI_INTERNALS__ !== undefined",
                "note": "Tauri 1.x uses window.__TAURI__, Tauri 2.x uses window.__TAURI_INTERNALS__"
            },
            {
                "name": "Chrome Profile Directory Structure",
                "note": "User Data Dir contains 'Local State' + profile folders (Default, Profile 1, etc.)"
            },
            {
                "name": "Angular CDK Drag Drop",
                "code": "cdkDropList + cdkDrag directives, moveItemInArray for reorder",
                "note": "Import DragDropModule from @angular/cdk/drag-drop"
            },
            {
                "name": "PrimeNG Charts",
                "code": "<p-chart type=\"pie\" [data]=\"chartData\" [options]=\"options\" />",
                "note": "Wrapper around Chart.js, auto-installed with PrimeNG"
            },
            {
                "name": "Tailwind v4 Source Configuration",
                "code": "@import 'tailwindcss' source(none);\n@source '../src/**/*.html';\n@source '../src/**/*.ts';",
                "note": "Disable auto-detection with source(none), then explicitly define paths to prevent scanning unintended files"
            },
            {
                "name": "localStorage Signal Initialization",
                "code": "signal<boolean>(typeof localStorage !== 'undefined' && localStorage.getItem('key') === 'true')",
                "note": "Safe pattern for SSR-compatible localStorage initialization with signals"
            },
            {
                "name": "Mobile Sidebar Drawer",
                "code": "[class.-translate-x-full]=\"!isOpen()\" [class.lg:translate-x-0]=\"true\" [class.lg:static]=\"true\"",
                "note": "Use translate-x with lg: breakpoint for sidebar that's hidden on mobile but fixed on desktop"
            },
            {
                "name": "Responsive Dialog Width",
                "code": "[style]=\"{ width: 'min(400px, 95vw)' }\"",
                "note": "Use CSS min() function for dialogs that adapt to viewport width on mobile"
            },
            {
                "name": "Responsive Button Visibility",
                "code": "class=\"hidden sm:inline-flex\" for desktop-only, class=\"sm:hidden\" for mobile-only",
                "note": "Pattern for showing different buttons on mobile vs desktop"
            }
        ],
        "gotchas": [
            {
                "issue": "Using --user-data-dir with profile subfolder creates NEW profile",
                "solution": "Use --user-data-dir=<parent> --profile-directory=<folder> for native profiles"
            },
            {
                "issue": "tauri-plugin-os not working",
                "solution": "Must add to Cargo.toml, register in lib.rs, AND add 'os:default' to capabilities"
            },
            {
                "issue": "PrimeNG v21 renamed InputSwitch to ToggleSwitch",
                "solution": "import { ToggleSwitchModule } from 'primeng/toggleswitch'; use <p-toggleSwitch>"
            },
            {
                "issue": "Rust zip crate may fail on special characters in filenames",
                "solution": "Use options.set_option(zip::write::FileOptions::default().utf_encoded_filenames(true))"
            },
            {
                "issue": "CDK DragDrop in grid layout",
                "solution": "Use cdkDropListDisabled to disable when not in custom sort mode"
            },
            {
                "issue": "Tailwind v4 CSS warning: Expected identifier but found - (invalid class like [-:|])",
                "solution": "Add source(none) to @import 'tailwindcss' and explicitly define @source paths"
            },
            {
                "issue": "NG8107 warning: optional chain operator not needed",
                "solution": "Replace ?.property ?? 'fallback' with @if control flow when signal type doesn't include undefined"
            },
            {
                "issue": "Horizontal tabs overflow on mobile",
                "solution": "Add overflow-x-auto scrollbar-hide whitespace-nowrap to nav container"
            },
            {
                "issue": "Sidebar blocks content on mobile",
                "solution": "Use fixed positioning with -translate-x-full to hide, lg:static lg:translate-x-0 to show on desktop"
            },
            {
                "issue": "App freezes when switching to Browsers tab (29 profiles)",
                "solution": "Root cause: 29 profiles × 3 I/O calls = 87 concurrent Tauri invokes. Fix: (1) Skip re-scan if profiles already loaded, (2) Defer loadProfileSizes with setTimeout"
            },
            {
                "issue": "Duplicate computed signals (proxyGroups in home.ts)",
                "solution": "Use service's existing computed signal directly instead of recreating"
            },
            {
                "issue": "Multiple .filter() calls in computed signals",
                "solution": "Use single-pass counting O(n) instead of O(4n) with multiple filter loops"
            },
            {
                "issue": "async ngOnInit blocks initial render",
                "solution": "Use fire-and-forget pattern: .then() instead of await in ngOnInit"
            },
            {
                "issue": "DMG build fails with 'Resource busy' when previous DMG still mounted",
                "solution": "Run 'hdiutil detach /Volumes/Angulogin' before npm run tauri build"
            },
            {
                "issue": "Chrome cookie encryption uses domain-specific key from Keychain",
                "solution": "Use 'Chrome Safe Storage' key from macOS Keychain, decrypt with PBKDF2 + AES-128-CBC, strip PKCS7 padding"
            },
            {
                "issue": "SameSite cookie value round-trip fails without 'unspecified' mapping",
                "solution": "Map sameSite: lax→1, strict→2, none→3, unspecified→0 (default). Without 'unspecified' case, import silently corrupts cookies"
            },
            {
                "issue": "Blocking Tauri commands freeze UI during heavy I/O",
                "solution": "Make commands async: pub async fn ... -> Result<T, String>. Tauri runs async commands on thread pool"
            }
        ],
        "conventions": [
            "All page components MUST have host: { class: 'flex-1 flex flex-col min-h-0 overflow-hidden' }",
            "Use async/await + firstValueFrom for user actions",
            "Commit after every significant change with semantic format",
            "All surfaces need dark: variants for dark mode (bg-surface-0 dark:bg-surface-900)",
            "Use PrimeNG Charts for visualization, not raw Chart.js",
            "New features added to ProfileMetadata must be updated in: TS model, Rust struct, save_profile_metadata, and service method",
            "All user-provided file imports must be sanitized before use (settings, CSV, JSON)",
            "All async operations (backup/restore/delete) should have loading guards to prevent double-click",
            "Rust backend uses validate_path_safety() for all file operations — checks traversal, symlinks, null bytes",
            "CSV export must use csvSafe() to prevent formula injection (=, +, -, @ prefix escaping)",
            "Structural borders (nav, sidebar, dividers) use lighter shades: border-surface-100 dark:border-surface-800",
            "Main-nav, sidebar, and home-container have border-top for visual separation below title bar"
        ],
        "competitor_analysis": {
            "completed_at": "2026-02-16",
            "competitors": [
                "GoLogin",
                "Multilogin",
                "AdsPower",
                "Incogniton",
                "Kameleo",
                "Octo Browser",
                "BitBrowser",
                "Dolphin Anty"
            ],
            "usp": [
                "Free & unlimited profiles",
                "Offline-first",
                "Data on external drive",
                "Lightweight (~10MB)",
                "Uses real Chrome"
            ],
            "gaps": [
                "Fingerprint spoofing",
                "Automation API",
                "Team collaboration"
            ],
            "report_path": "competitor_analysis.md (in Antigravity brain artifacts)"
        }
    }
}