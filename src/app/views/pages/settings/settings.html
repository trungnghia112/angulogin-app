<!-- Settings Page Layout: Sidebar + Content -->

<!-- Sidebar -->
<aside id="settings-sidebar"
    class="flex flex-col h-full w-60 border-r border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 shrink-0">

    <!-- Header -->
    <div id="settings-sidebar-header"
        class="h-[var(--spacing-header)] flex items-center px-6 border-b border-surface-200 dark:border-surface-700 shrink-0">
        <h1 id="settings-sidebar-title" class="text-xl font-bold text-color">Settings</h1>
    </div>

    <!-- Navigation -->
    <nav id="settings-sidebar-nav" class="flex-1 p-3 flex flex-col gap-1 overflow-y-auto">
        @for (category of categories; track category.id; let i = $index) {
        <button [id]="'settings-nav-' + category.id" (click)="selectCategory(category.id)"
            class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-left"
            [class]="activeCategory() === category.id 
                ? 'bg-primary/10 text-primary' 
                : 'text-muted-color hover:bg-surface-100 dark:hover:bg-surface-800 hover:text-color'">
            <i [class]="category.icon + ' text-lg'"></i>
            {{ category.label }}
        </button>
        }
    </nav>
</aside>

<!-- Content Area -->
<div id="settings-content" class="flex-1 flex flex-col bg-surface-50 dark:bg-surface-950 min-h-0 overflow-hidden">

    <!-- Content Header -->
    <div id="settings-content-header"
        class="h-[var(--spacing-header)] flex items-center px-8 border-b border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 shrink-0">
        <h2 class="text-lg font-semibold text-color capitalize">{{ activeCategory() }}</h2>
    </div>

    <!-- Scrollable Content -->
    <div class="flex-1 p-8 overflow-y-auto">

        <!-- Appearance Section -->
        @if (activeCategory() === 'appearance') {
        <div class="max-w-3xl flex flex-col gap-8">

            <!-- Dark Mode Toggle -->
            <section id="settings-darkmode"
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-base font-semibold text-color mb-1">Dark Mode</h3>
                        <p class="text-sm text-muted-color">Switch between light and dark themes</p>
                    </div>
                    <p-button [icon]="settingsService.isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'"
                        [label]="settingsService.isDarkMode() ? 'Light' : 'Dark'" [outlined]="true"
                        (click)="toggleDarkMode()" />
                </div>
            </section>

            <!-- Primary Color -->
            <section id="settings-primary-color"
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <h3 class="text-sm font-semibold text-muted-color mb-4 uppercase tracking-wider">Primary Color</h3>
                <div class="flex flex-wrap gap-4">
                    @for (color of primaryColors; track color.name) {
                    <button [id]="'settings-color-' + color.name" (click)="setPrimaryColor(color.name)"
                        class="w-12 h-12 rounded-full border-2 transition-all duration-200 shadow-sm relative flex items-center justify-center shrink-0 cursor-pointer"
                        [class.border-surface-300]="settingsService.appearance().primaryColor !== color.name"
                        [class.dark:border-surface-600]="settingsService.appearance().primaryColor !== color.name"
                        [class.border-primary]="settingsService.appearance().primaryColor === color.name"
                        [class.ring-2]="settingsService.appearance().primaryColor === color.name"
                        [class.ring-offset-2]="settingsService.appearance().primaryColor === color.name"
                        [class.ring-primary]="settingsService.appearance().primaryColor === color.name"
                        [style.background-color]="color.hex" [pTooltip]="color.label" tooltipPosition="top">
                        @if (settingsService.appearance().primaryColor === color.name) {
                        <i class="pi pi-check text-white font-bold text-lg drop-shadow-md"></i>
                        }
                    </button>
                    }
                </div>
            </section>

            <!-- Surface Palette -->
            <section id="settings-surface"
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <h3 class="text-sm font-semibold text-muted-color mb-4 uppercase tracking-wider">Background Theme</h3>
                <div class="flex flex-wrap gap-4">
                    @for (surface of surfacePalettes; track surface.name) {
                    <button [id]="'settings-surface-' + surface.name" (click)="setSurface(surface.name)"
                        class="flex-1 min-w-[100px] h-12 rounded-lg border-2 transition-all duration-200 shadow-sm relative flex items-center justify-center shrink-0 cursor-pointer bg-surface-100 dark:bg-surface-800"
                        [class.border-surface-300]="settingsService.appearance().surface !== surface.name"
                        [class.dark:border-surface-600]="settingsService.appearance().surface !== surface.name"
                        [class.border-primary]="settingsService.appearance().surface === surface.name">
                        <div class="flex items-center gap-2">
                            <div class="w-5 h-5 rounded-full border border-surface-300 dark:border-surface-600"
                                [style.background-color]="surface.hex"></div>
                            <span class="text-sm font-medium text-color">{{ surface.label }}</span>
                        </div>
                        @if (settingsService.appearance().surface === surface.name) {
                        <div
                            class="absolute -top-1 -right-1 w-5 h-5 bg-primary text-white rounded-full flex items-center justify-center shadow-sm">
                            <i class="pi pi-check text-[10px] font-bold"></i>
                        </div>
                        }
                    </button>
                    }
                </div>
            </section>

            <!-- UI Scale -->
            <section id="settings-scale"
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <h3 class="text-sm font-semibold text-muted-color mb-4 uppercase tracking-wider">Interface Scale</h3>
                <div class="flex items-center gap-4">
                    @for (scale of uiScales; track scale.value) {
                    <button [id]="'settings-scale-' + scale.value" (click)="setScale(scale.value)"
                        class="px-6 py-3 rounded-lg text-sm font-medium transition-all cursor-pointer"
                        [class]="settingsService.appearance().scale === scale.value 
                            ? 'bg-primary text-primary-contrast shadow-sm' 
                            : 'bg-surface-100 dark:bg-surface-800 text-muted-color hover:text-color hover:bg-surface-200 dark:hover:bg-surface-700'">
                        {{ scale.label }}
                    </button>
                    }
                </div>
            </section>

        </div>
        }

        <!-- General Section -->
        @if (activeCategory() === 'general') {
        <div class="max-w-3xl flex flex-col gap-8">

            <!-- Startup Behavior -->
            <section
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <h3 class="text-base font-semibold text-color mb-6">Startup & Launch</h3>

                <div class="flex flex-col gap-6">
                    <!-- Default Browser -->
                    <div class="flex flex-col gap-3">
                        <label class="text-sm font-medium text-muted-color">Default Browser Engine</label>
                        <p-selectButton [options]="browserOptions" [ngModel]="settingsService.general().defaultBrowser"
                            optionLabel="label" optionValue="value" (onChange)="updateGeneral('defaultBrowser', $event)"
                            styleClass="w-full">
                            <ng-template let-item pTemplate>
                                <div class="flex items-center justify-center gap-2 w-full">
                                    <i [class]="item.icon"></i>
                                    <span>{{item.label}}</span>
                                </div>
                            </ng-template>
                        </p-selectButton>
                        <p class="text-xs text-muted-color">Used when creating new profiles or launching Quick Actions.
                        </p>
                    </div>

                    <!-- On Launch -->
                    <div class="flex flex-col gap-3">
                        <label class="text-sm font-medium text-muted-color">After Launching Profile</label>
                        <p-selectButton [options]="launchOptions" [ngModel]="settingsService.general().onLaunch"
                            optionLabel="label" optionValue="value" (onChange)="updateGeneral('onLaunch', $event)"
                            styleClass="w-full">
                            <ng-template let-item pTemplate>
                                <div class="flex items-center justify-center gap-2 w-full">
                                    <i [class]="item.icon"></i>
                                    <span>{{item.label}}</span>
                                </div>
                            </ng-template>
                        </p-selectButton>
                    </div>
                </div>
            </section>

            <!-- Application Config -->
            <section
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <h3 class="text-base font-semibold text-color mb-6">Application Preferences</h3>

                <div class="flex flex-col gap-4">
                    <!-- Launch at Startup -->
                    <div
                        class="flex items-center justify-between p-2 hover:bg-surface-50 dark:hover:bg-surface-800/50 rounded-lg transition-colors">
                        <div>
                            <p class="text-sm font-medium text-color">Launch at Startup</p>
                            <p class="text-xs text-muted-color">Automatically start app when you log in</p>
                        </div>
                        <p-toggleSwitch [ngModel]="settingsService.general().launchAtStartup"
                            (onChange)="updateGeneral('launchAtStartup', $event)" />
                    </div>

                    <div class="h-px bg-surface-100 dark:bg-surface-800"></div>

                    <!-- Start Minimized -->
                    <div class="flex items-center justify-between p-2 hover:bg-surface-50 dark:hover:bg-surface-800/50 rounded-lg transition-colors"
                        [class.opacity-50]="!settingsService.general().launchAtStartup"
                        [class.pointer-events-none]="!settingsService.general().launchAtStartup">
                        <div>
                            <p class="text-sm font-medium text-color">Start Minimized</p>
                            <p class="text-xs text-muted-color">Do not show main window on startup</p>
                        </div>
                        <p-toggleSwitch [ngModel]="settingsService.general().startMinimized"
                            [disabled]="!settingsService.general().launchAtStartup"
                            (onChange)="updateGeneral('startMinimized', $event)" />
                    </div>

                    <div class="h-px bg-surface-100 dark:bg-surface-800"></div>

                    <!-- Confirm Delete -->
                    <div
                        class="flex items-center justify-between p-2 hover:bg-surface-50 dark:hover:bg-surface-800/50 rounded-lg transition-colors">
                        <div>
                            <p class="text-sm font-medium text-color">Confirm Deletion</p>
                            <p class="text-xs text-muted-color">Show warning before deleting a profile</p>
                        </div>
                        <p-toggleSwitch [ngModel]="settingsService.general().confirmDelete"
                            (onChange)="updateGeneral('confirmDelete', $event)" />
                    </div>
                </div>
            </section>

        </div>
        }

        <!-- Browser Paths Section -->
        @if (activeCategory() === 'browser') {
        <div class="max-w-3xl flex flex-col gap-8">

            <section id="settings-browser-path"
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <div class="mb-4">
                    <h3 class="text-base font-semibold text-color mb-1">Profiles Directory</h3>
                    <p class="text-sm text-muted-color">Select the folder where your Chrome User Data is stored.</p>
                </div>

                <div class="flex flex-col gap-2">
                    <p-inputGroup>
                        <input pInputText [value]="settingsService.browser().profilesPath" readonly
                            placeholder="No folder selected" class="w-full" />
                        <button type="button" pButton label="Browse" icon="pi pi-folder-open"
                            (click)="browseProfilesPath()"></button>
                    </p-inputGroup>

                    <div class="flex justify-end mt-2">
                        <p-button label="Reset to Default" icon="pi pi-refresh" [text]="true" severity="secondary"
                            size="small" (click)="resetProfilesPath()" />
                    </div>
                </div>
            </section>

        </div>
        }

        <!-- Data Section -->
        @if (activeCategory() === 'data') {
        <div class="max-w-3xl flex flex-col gap-8">

            <!-- Backup & Restore -->
            <section
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-surface-200 dark:border-surface-700">
                <h3 class="text-base font-semibold text-color mb-6">Backup & Restore</h3>

                <div class="flex flex-col gap-6">
                    <!-- Export -->
                    <div class="flex items-center justify-between p-4 bg-surface-50 dark:bg-surface-800/50 rounded-lg">
                        <div>
                            <p class="text-sm font-medium text-color">Export Configuration</p>
                            <p class="text-xs text-muted-color">Save your settings to a JSON file for backup</p>
                        </div>
                        <p-button label="Export" icon="pi pi-download" [outlined]="true" (click)="exportConfig()" />
                    </div>

                    <!-- Import -->
                    <div class="flex items-center justify-between p-4 bg-surface-50 dark:bg-surface-800/50 rounded-lg">
                        <div>
                            <p class="text-sm font-medium text-color">Import Configuration</p>
                            <p class="text-xs text-muted-color">Restore settings from a previously exported file</p>
                        </div>
                        <p-button label="Import" icon="pi pi-upload" [outlined]="true" (click)="importConfig()" />
                    </div>
                </div>
            </section>

            <!-- Danger Zone -->
            <section
                class="bg-surface-0 dark:bg-surface-900 p-6 rounded-xl border border-red-200 dark:border-red-900/50">
                <h3 class="text-base font-semibold text-red-600 dark:text-red-400 mb-6">Danger Zone</h3>

                <div
                    class="flex items-center justify-between p-4 bg-red-50 dark:bg-red-950/30 rounded-lg border border-red-100 dark:border-red-900/30">
                    <div>
                        <p class="text-sm font-medium text-color">Clear All Data</p>
                        <p class="text-xs text-muted-color">Reset all settings to default. This cannot be undone.</p>
                    </div>
                    <p-button label="Clear Data" icon="pi pi-trash" severity="danger" (click)="clearData()" />
                </div>
            </section>

        </div>
        }

    </div>
</div>