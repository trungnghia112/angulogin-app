<div id="automation-container" class="flex-1 flex flex-col min-h-0 overflow-hidden">

    <!-- Header Bar -->
    <div id="automation-header"
        class="h-[var(--spacing-header)] flex items-center justify-between px-8 border-b border-surface-100 dark:border-surface-800 bg-surface-0 dark:bg-surface-900 shrink-0">
        <div class="flex items-center gap-3">
            <h1 class="text-lg font-semibold text-color">API Documentation</h1>
            <span class="text-xs text-muted-color font-mono">v1</span>
        </div>
        <div class="flex items-center gap-3">
            <!-- Status Dot -->
            <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-50 dark:bg-surface-800 text-xs">
                @if (apiOnline() === null) {
                <i class="pi pi-circle text-surface-400"></i>
                <span class="text-muted-color">Checking...</span>
                } @else if (apiOnline()) {
                <i class="pi pi-circle-fill text-green-500"></i>
                <span class="text-green-600 dark:text-green-400 font-medium">Online</span>
                } @else {
                <i class="pi pi-circle-fill text-red-500"></i>
                <span class="text-red-600 dark:text-red-400 font-medium">Offline</span>
                }
                <span class="text-muted-color font-mono">{{ api.connectionUrl() }}</span>
            </div>
            <p-button icon="pi pi-refresh" [rounded]="true" [text]="true" severity="secondary" size="small"
                (click)="checkApiOnline()" pTooltip="Refresh status" />
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="flex-1 overflow-y-auto p-8">
        <div class="max-w-4xl flex flex-col gap-4 mx-auto">

            <!-- Endpoint List -->
            @for (ep of endpoints; track ep.path; let i = $index) {
            <div [id]="'automation-endpoint-' + i"
                class="bg-surface-0 dark:bg-surface-900 rounded-xl border border-surface-100 dark:border-surface-800 overflow-hidden transition-shadow"
                [class.ring-1]="expandedIndex() === i" [class.ring-primary]="expandedIndex() === i">

                <!-- Endpoint Row (clickable) -->
                <button (click)="toggleExpand(i)"
                    class="w-full flex items-center gap-4 px-5 py-4 text-left hover:bg-surface-50 dark:hover:bg-surface-800/50 transition-colors cursor-pointer">
                    <!-- Method badge -->
                    <span class="method-badge" [class.method-get]="ep.method === 'GET'"
                        [class.method-post]="ep.method === 'POST'">
                        {{ ep.method }}
                    </span>
                    <!-- Path -->
                    <span class="font-mono text-sm text-color flex-1">{{ ep.path }}</span>
                    <!-- Description -->
                    <span class="text-xs text-muted-color hidden sm:block max-w-[240px] truncate">{{ ep.description
                        }}</span>
                    <!-- Auth badge -->
                    @if (ep.auth) {
                    <i class="pi pi-lock text-xs text-muted-color" pTooltip="Requires API Key"></i>
                    } @else {
                    <i class="pi pi-lock-open text-xs text-green-500" pTooltip="Public"></i>
                    }
                    <!-- Expand icon -->
                    <i class="pi text-xs text-muted-color" [class.pi-chevron-down]="expandedIndex() !== i"
                        [class.pi-chevron-up]="expandedIndex() === i"></i>
                </button>

                <!-- Expanded Detail -->
                @if (expandedIndex() === i) {
                <div class="border-t border-surface-100 dark:border-surface-800 px-5 py-5 flex flex-col gap-5">

                    <!-- Description -->
                    <p class="text-sm text-muted-color">{{ ep.description }}</p>

                    <!-- Parameters -->
                    @if (ep.params.length > 0) {
                    <div>
                        <h4 class="text-xs font-semibold text-muted-color uppercase tracking-wider mb-3">Parameters</h4>
                        <div class="flex flex-col gap-2">
                            @for (p of ep.params; track p.name) {
                            <div class="flex items-center gap-3 text-sm">
                                <code
                                    class="px-2 py-0.5 bg-surface-100 dark:bg-surface-800 rounded text-xs font-mono text-color">{{
                                    p.name }}</code>
                                <span class="text-xs text-muted-color">{{ p.type }}</span>
                                @if (p.required) {
                                <span class="text-xs text-red-500 font-medium">required</span>
                                }
                                <span class="text-xs text-muted-color">{{ p.description }}</span>
                            </div>
                            }
                        </div>
                    </div>
                    }

                    <!-- Request Body (POST) -->
                    @if (ep.exampleBody) {
                    <div>
                        <h4 class="text-xs font-semibold text-muted-color uppercase tracking-wider mb-3">Request Body
                        </h4>
                        <pre class="json-block text-xs">{{ ep.exampleBody }}</pre>
                    </div>
                    }

                    <!-- Example Response -->
                    <div>
                        <h4 class="text-xs font-semibold text-muted-color uppercase tracking-wider mb-3">Example
                            Response</h4>
                        <pre class="json-block text-xs">{{ ep.exampleResponse }}</pre>
                    </div>

                    <!-- Code Examples -->
                    <div>
                        <h4 class="text-xs font-semibold text-muted-color uppercase tracking-wider mb-3">Code Examples
                        </h4>
                        <p-tabs value="0">
                            <p-tablist>
                                <p-tab value="0">cURL</p-tab>
                                <p-tab value="1">Python</p-tab>
                                <p-tab value="2">Node.js</p-tab>
                            </p-tablist>
                            <p-tabpanels>
                                <p-tabpanel value="0">
                                    <div class="relative mt-3">
                                        <pre class="json-block text-xs">{{ getCurlCommand(ep) }}</pre>
                                        <button
                                            class="absolute top-2 right-2 p-1.5 rounded-md bg-surface-200/80 dark:bg-surface-700/80 hover:bg-surface-300 dark:hover:bg-surface-600 transition-colors"
                                            (click)="copyCurl(ep)" pTooltip="Copy">
                                            <i class="pi pi-copy text-xs text-muted-color"></i>
                                        </button>
                                    </div>
                                </p-tabpanel>
                                <p-tabpanel value="1">
                                    <div class="relative mt-3">
                                        <pre class="json-block text-xs">{{ getPythonCode(ep) }}</pre>
                                        <button
                                            class="absolute top-2 right-2 p-1.5 rounded-md bg-surface-200/80 dark:bg-surface-700/80 hover:bg-surface-300 dark:hover:bg-surface-600 transition-colors"
                                            (click)="copyCode(getPythonCode(ep))" pTooltip="Copy">
                                            <i class="pi pi-copy text-xs text-muted-color"></i>
                                        </button>
                                    </div>
                                </p-tabpanel>
                                <p-tabpanel value="2">
                                    <div class="relative mt-3">
                                        <pre class="json-block text-xs">{{ getNodeCode(ep) }}</pre>
                                        <button
                                            class="absolute top-2 right-2 p-1.5 rounded-md bg-surface-200/80 dark:bg-surface-700/80 hover:bg-surface-300 dark:hover:bg-surface-600 transition-colors"
                                            (click)="copyCode(getNodeCode(ep))" pTooltip="Copy">
                                            <i class="pi pi-copy text-xs text-muted-color"></i>
                                        </button>
                                    </div>
                                </p-tabpanel>
                            </p-tabpanels>
                        </p-tabs>
                    </div>

                    <!-- Try It -->
                    <div class="flex flex-col gap-3">
                        <div class="flex items-center gap-3">
                            <p-button label="Try It" icon="pi pi-play" [outlined]="true" size="small"
                                [loading]="tryLoading()" (click)="tryEndpoint(ep)" [disabled]="!apiOnline()" />
                            @if (tryStatus() !== null) {
                            <span class="text-xs font-mono"
                                [class.text-green-500]="tryStatus()! >= 200 && tryStatus()! < 300"
                                [class.text-yellow-500]="tryStatus()! >= 300 && tryStatus()! < 500"
                                [class.text-red-500]="tryStatus()! >= 500 || tryStatus() === 0">
                                {{ tryStatus() === 0 ? 'Connection Failed' : 'HTTP ' + tryStatus() }}
                            </span>
                            }
                        </div>
                        @if (tryResult()) {
                        <pre class="json-block text-xs max-h-64 overflow-auto">{{ tryResult() }}</pre>
                        }
                    </div>

                </div>
                }
            </div>
            }

        </div>
    </div>

</div>