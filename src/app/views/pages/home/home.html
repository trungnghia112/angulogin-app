<!-- Sidebar (responsive: drawer on mobile, static on desktop) - Hidden in Zen Mode -->
@if (!zenMode()) {
<app-home-sidebar [folders]="folderService.folderTree()" [selectedFolderId]="selectedFolderId()"
    [isOpen]="sidebarOpen()" (folderSelected)="onFolderSelected($event)" (addFolderClicked)="onAddFolder()"
    (settingsClicked)="onSettings()" (folderSettingsClicked)="openManageFolders()"
    (closeSidebar)="sidebarOpen.set(false)" />
}

<!-- Main Content -->
<div id="home-container" class="flex-1 flex flex-col min-h-0 text-color overflow-hidden">
    <!-- Header Toolbar -->
    <app-profile-toolbar [searchText]="searchText()" [viewMode]="viewMode()" [sortBy]="sortBy()"
        [sortOrder]="sortOrder()" [selectedCount]="selectedProfiles().length" [uniqueGroups]="uniqueGroups()"
        [filterGroup]="filterGroup()" [activeFilterCount]="activeFilterCount()" [showHidden]="showHidden()"
        [filterFavoritesOnly]="filterFavoritesOnly()" [favoriteCount]="favoriteCount()" [compactMode]="compactMode()"
        [todayActivityCount]="activityLog.todayEntries().length" (searchChange)="onSearchInput($event)"
        (viewModeChange)="viewMode.set($event)" (sortByChange)="sortBy.set($event)"
        (sortOrderChange)="sortOrder.set($event)" (filterGroupChange)="setFilterGroup($event)"
        (showHiddenChange)="showHidden.set($event)" (filterFavoritesOnlyChange)="filterFavoritesOnly.set($event)"
        (compactModeChange)="toggleCompactMode()" (scan)="scanProfiles()" (create)="openCreateDialog()"
        (bulkCreate)="openBulkCreateDialog()" (createFromTemplate)="openCreateFromTemplateDialog()"
        (openSidebar)="sidebarOpen.set(true)" (showActivityLog)="showActivityLog.set(true)"
        (restoreFromBackup)="restoreFromBackup()" (clearFilters)="clearFilters()" (exportProfiles)="exportProfiles()"
        (importProfiles)="importProfiles()" />

    <!-- Tabs (scrollable on mobile) -->
    <div id="home-tabs"
        class="flex items-center justify-between px-3 sm:px-6 py-2 sm:py-3 border-b border-surface shrink-0">
        <nav id="home-tabs-nav"
            class="flex items-center gap-3 sm:gap-6 overflow-x-auto scrollbar-hide whitespace-nowrap">
            @for (tab of tabs; track tab.key; let i = $index) {
            <button [id]="'home-tab-' + i"
                class="flex items-center gap-1.5 sm:gap-2 pb-2 text-xs sm:text-sm font-medium transition-colors border-b-2 -mb-[9px] sm:-mb-[13px] shrink-0"
                [class]="activeTab() === tab.key
            ? 'text-color border-primary'
            : 'text-muted-color border-transparent hover:text-muted-color'" (click)="setActiveTab(tab.key)">
                <i [class]="'pi ' + tab.icon + ' text-xs sm:text-sm'"></i>
                <span class="hidden sm:inline">{{ tab.label }}</span>
            </button>
            }
        </nav>
        <span id="home-tabs-usage" class="text-xs sm:text-sm text-muted-color shrink-0 ml-2">{{ profilesUsed() }} / {{
            maxProfiles() }}</span>
    </div>

    <!-- Content -->
    <div id="home-content" class="flex-1 min-h-0" [class.overflow-hidden]="viewMode() === 'table'"
        [class.overflow-auto]="viewMode() !== 'table'">
        @if (loading()) {
        <div id="home-loading" class="flex flex-col items-center justify-center py-16 gap-4 text-muted-color">
            <p-progressSpinner strokeWidth="3" />
            <p>Scanning profiles...</p>
        </div>
        } @else if (profiles().length === 0) {
        <div id="home-empty" class="flex flex-col items-center justify-center py-16 text-center">
            <div id="home-empty-icon"
                class="w-20 h-20 rounded-2xl border border-surface flex items-center justify-center mb-5">
                <i class="pi pi-inbox text-3xl text-zinc-400"></i>
            </div>
            <h3 id="home-empty-title" class="text-lg font-semibold text-color mb-2">No
                Profiles Found</h3>
            <p id="home-empty-desc" class="text-sm text-muted-color">Enter the path to your Chrome
                profiles folder and
                click Scan</p>
        </div>
        } @else if (filteredProfiles().length === 0 && hasActiveFilters()) {
        <!-- No search results -->
        <div id="home-no-results" class="flex flex-col items-center justify-center py-16 text-center">
            <div class="w-20 h-20 rounded-2xl border border-surface flex items-center justify-center mb-5">
                <i class="pi pi-search text-3xl text-zinc-400"></i>
            </div>
            <h3 class="text-lg font-semibold text-color mb-2">No Matching Profiles</h3>
            <p class="text-sm text-muted-color mb-4">Try adjusting your search or filters</p>
            <button (click)="clearFilters()"
                class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-lg hover:bg-primary-hover transition-colors">
                Clear filters
            </button>
        </div>
        } @else if (activeTab() === 'profiles') {

        <!-- Profiles View - Table or Grid -->
        @if (viewMode() === 'table') {
        <!-- Profiles Table with Virtual Scrolling -->
        <p-table id="home-profiles-table" [value]="paginatedProfiles()" [(selection)]="selectedProfiles"
            (selectionChange)="onSelectionChange($event)" dataKey="path" [scrollable]="true" scrollHeight="flex"
            [resizableColumns]="true" columnResizeMode="expand" [sortField]="sortBy()"
            [sortOrder]="sortOrder() === 'asc' ? 1 : -1" (onSort)="onTableSort($event)">

            <!-- Header -->
            <ng-template pTemplate="header">
                <tr id="home-profiles-table-header">
                    <th style="width: 3rem"><p-tableHeaderCheckbox /></th>
                    @if (columnConfig.isVisible('pin')) {
                    <th style="width: 3rem"><i class="pi pi-star"></i></th>
                    }
                    <th pResizableColumn pSortableColumn="name">Name <p-sortIcon field="name" /></th>
                    @if (columnConfig.isVisible('status')) {
                    <th pResizableColumn>Status</th>
                    }
                    @if (columnConfig.isVisible('proxy')) {
                    <th pResizableColumn pSortableColumn="metadata.proxy">Proxy <p-sortIcon field="metadata.proxy" />
                    </th>
                    }
                    @if (columnConfig.isVisible('tags')) {
                    <th pResizableColumn>Tags</th>
                    }
                    @if (columnConfig.isVisible('notes')) {
                    <th pResizableColumn>Notes</th>
                    }
                    @if (columnConfig.isVisible('lastChanged')) {
                    <th pResizableColumn pSortableColumn="metadata.lastOpened">Last Changed <p-sortIcon
                            field="metadata.lastOpened" /></th>
                    }
                    @if (columnConfig.isVisible('runningTime')) {
                    <th pResizableColumn>Running Time</th>
                    }
                    @if (columnConfig.isVisible('size')) {
                    <th pResizableColumn pSortableColumn="size">Size <p-sortIcon field="size" /></th>
                    }
                    @if (columnConfig.isVisible('launchCount')) {
                    <th pResizableColumn pSortableColumn="metadata.launchCount">Launches <p-sortIcon
                            field="metadata.launchCount" /></th>
                    }
                    @if (columnConfig.isVisible('browser')) {
                    <th pResizableColumn pSortableColumn="metadata.browser">Browser <p-sortIcon
                            field="metadata.browser" /></th>
                    }
                    @if (columnConfig.isVisible('group')) {
                    <th pResizableColumn pSortableColumn="metadata.group">Group <p-sortIcon field="metadata.group" />
                    </th>
                    }
                    <th style="width: 3rem">
                        <button id="home-column-settings-btn"
                            (click)="showColumnSettings.set(true); $event.stopPropagation()"
                            class="w-7 h-7 rounded-md flex items-center justify-center text-muted-color hover:text-primary transition-colors"
                            pTooltip="Customize columns">
                            <i class="pi pi-cog"></i>
                        </button>
                    </th>
                </tr>
            </ng-template>

            <!-- Body -->
            <ng-template pTemplate="body" let-profile let-i="rowIndex">
                <tr [id]="'home-profile-row-' + i" (click)="openEditDialog(profile, $event)" style="cursor: pointer">
                    <!-- Checkbox -->
                    <td (click)="$event.stopPropagation()">
                        <p-tableCheckbox [value]="profile" />
                    </td>

                    <!-- Pin -->
                    @if (columnConfig.isVisible('pin')) {
                    <td>
                        <button [id]="'home-profile-' + i + '-pin-btn'" (click)="togglePin(profile, $event)"
                            class="w-7 h-7 rounded-md transition-colors flex items-center justify-center" [class]="profile.metadata?.isPinned 
                                     ? 'text-yellow-400 hover:text-yellow-300' 
                                     : 'text-muted-color hover:text-zinc-400'">
                            <i [class]="profile.metadata?.isPinned ? 'pi pi-star-fill' : 'pi pi-star'"></i>
                        </button>
                    </td>
                    }

                    <!-- Name with Start button -->
                    <td>
                        <div class="flex items-center gap-3">
                            @if (profile.metadata?.color) {
                            <span class="w-3 h-3 rounded-full flex-shrink-0"
                                [style.background-color]="profile.metadata.color"></span>
                            }
                            <p-button [id]="'home-profile-' + i + '-start-btn'" (click)="launchProfile(profile, $event)"
                                [icon]="'pi ' + getOsIcon(profile)" label="Start" size="small" [outlined]="true" />
                            <span [class]="profile.metadata?.isHidden ? 'opacity-50' : ''"
                                [pTooltip]="getProfileTooltip(profile)" tooltipPosition="right" [escape]="false">{{
                                profile.name }}</span>
                            @if (profile.metadata?.isHidden) {
                            <i class="pi pi-eye-slash text-xs text-muted-color" pTooltip="Hidden profile"></i>
                            }
                        </div>
                    </td>

                    <!-- Status -->
                    @if (columnConfig.isVisible('status')) {
                    <td>
                        <span class="px-2.5 py-1 border border-surface rounded text-xs text-muted-color">
                            No status
                        </span>
                    </td>
                    }

                    <!-- Proxy -->
                    @if (columnConfig.isVisible('proxy')) {
                    <td>
                        @if (profile.metadata?.proxy) {
                        @let geo = getProxyGeoInfo(profile.metadata?.proxy);
                        <span
                            class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-surface-100 dark:bg-surface-800 border border-surface rounded text-xs text-color font-mono"
                            [pTooltip]="profile.metadata?.proxy" tooltipPosition="top">
                            @if (geo) {
                            <span [pTooltip]="geo.label" tooltipPosition="top" class="cursor-default" role="img"
                                [attr.aria-label]="geo.label">{{ geo.flag
                                }}</span>
                            }
                            <i class="pi pi-globe text-[10px] text-primary"></i>
                            <span class="max-w-[120px] truncate">{{ profile.metadata?.proxy }}</span>
                        </span>
                        } @else {
                        <p-button [id]="'home-profile-' + i + '-proxy-btn'" icon="pi pi-plus" [rounded]="true"
                            [text]="true" severity="secondary" size="small" (click)="openEditDialog(profile, $event)"
                            pTooltip="Add Proxy" />
                        }
                    </td>
                    }

                    <!-- Tags -->
                    @if (columnConfig.isVisible('tags')) {
                    <td>
                        @if (profile.metadata?.tags && profile.metadata.tags.length > 0) {
                        <div class="flex flex-wrap gap-1">
                            @for (tag of profile.metadata.tags.slice(0, 3); track tag) {
                            <span
                                class="px-2 py-0.5 bg-primary/20 border border-primary/40 rounded text-xs text-primary">
                                {{ tag }}
                            </span>
                            }
                            @if (profile.metadata.tags.length > 3) {
                            <span class="px-2 py-0.5 border border-surface rounded text-xs text-color">
                                +{{ profile.metadata.tags.length - 3 }}
                            </span>
                            }
                        </div>
                        } @else {
                        <p-button [id]="'home-profile-' + i + '-tags-btn'" icon="pi pi-plus" [rounded]="true"
                            [text]="true" severity="secondary" size="small" />
                        }
                    </td>
                    }

                    <!-- Notes -->
                    @if (columnConfig.isVisible('notes')) {
                    <td>
                        @if (profile.metadata?.notes) {
                        <span
                            class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-note-yellow/20 border border-note-yellow/40 rounded text-xs text-note-yellow">
                            <i class="pi pi-pencil text-[10px]"></i>
                            <span class="max-w-[100px] truncate">{{ profile.metadata?.notes }}</span>
                        </span>
                        } @else {
                        <p-button [id]="'home-profile-' + i + '-notes-btn'" icon="pi pi-plus" [rounded]="true"
                            [text]="true" severity="secondary" size="small" />
                        }
                    </td>
                    }

                    <!-- Last Changed (Feature 11.4) -->
                    @if (columnConfig.isVisible('lastChanged')) {
                    <td>
                        <span class="text-xs text-muted-color whitespace-nowrap">{{
                            formatRelativeDate(profile.metadata?.lastOpened) }}</span>
                    </td>
                    }

                    <!-- Running Time (Feature 11.5) -->
                    @if (columnConfig.isVisible('runningTime')) {
                    <td>
                        @if (profile.metadata?.totalUsageMinutes) {
                        <span
                            class="inline-flex items-center gap-1 px-2 py-0.5 bg-surface-100 dark:bg-surface-800 rounded text-xs text-color">
                            <i class="pi pi-clock text-[10px] text-muted-color"></i>
                            {{ formatMinutes(profile.metadata.totalUsageMinutes) }}
                        </span>
                        } @else {
                        <span class="text-xs text-muted-color">-</span>
                        }
                    </td>
                    }

                    <!-- Size (Feature 11.1 - new column) -->
                    @if (columnConfig.isVisible('size')) {
                    <td>
                        <span class="text-xs text-muted-color whitespace-nowrap">{{ formatSize(profile.size) || '-'
                            }}</span>
                    </td>
                    }

                    <!-- Launch Count (Feature 11.1 - new column) -->
                    @if (columnConfig.isVisible('launchCount')) {
                    <td>
                        @if (profile.metadata?.launchCount) {
                        <span
                            class="inline-flex items-center gap-1 px-2 py-0.5 bg-surface-100 dark:bg-surface-800 rounded text-xs text-color">
                            <i class="pi pi-play text-[10px] text-muted-color"></i>
                            {{ profile.metadata.launchCount }}
                        </span>
                        } @else {
                        <span class="text-xs text-muted-color">-</span>
                        }
                    </td>
                    }

                    <!-- Browser (Feature 11.1 - new column) -->
                    @if (columnConfig.isVisible('browser')) {
                    <td>
                        <span class="text-xs text-color">{{ getBrowserName(profile.metadata?.browser) }}</span>
                    </td>
                    }

                    <!-- Group (Feature 11.1 - new column) -->
                    @if (columnConfig.isVisible('group')) {
                    <td>
                        @if (profile.metadata?.group) {
                        <span class="px-2 py-0.5 bg-surface-100 dark:bg-surface-800 rounded text-xs text-color">
                            {{ profile.metadata.group }}
                        </span>
                        } @else {
                        <span class="text-xs text-muted-color">-</span>
                        }
                    </td>
                    }

                    <!-- Actions -->
                    <td>
                        <div class="flex items-center gap-1">
                            <p-button [id]="'home-profile-' + i + '-incognito-btn'"
                                (click)="launchProfileIncognito(profile, $event)" icon="pi pi-eye-slash"
                                [rounded]="true" [text]="true" severity="secondary" size="small"
                                pTooltip="Launch in Incognito" />
                            <p-button [id]="'home-profile-' + i + '-duplicate-btn'"
                                (click)="openDuplicateDialog(profile, $event)" icon="pi pi-copy" [rounded]="true"
                                [text]="true" severity="secondary" size="small" pTooltip="Duplicate profile" />
                            <p-button [id]="'home-profile-' + i + '-backup-btn'"
                                (click)="backupProfile(profile, $event)" icon="pi pi-download" [rounded]="true"
                                [text]="true" severity="secondary" size="small" pTooltip="Backup to ZIP" />
                            <p-button [id]="'home-profile-' + i + '-hide-btn'" (click)="toggleHide(profile, $event)"
                                [icon]="profile.metadata?.isHidden ? 'pi pi-eye' : 'pi pi-eye-slash'" [rounded]="true"
                                [text]="true" severity="secondary" size="small"
                                [pTooltip]="profile.metadata?.isHidden ? 'Show profile' : 'Hide profile'" />
                            <p-button [id]="'home-profile-' + i + '-favorite-btn'"
                                (click)="toggleFavorite(profile, $event)"
                                [icon]="profile.metadata?.isFavorite ? 'pi pi-heart-fill' : 'pi pi-heart'"
                                [rounded]="true" [text]="true"
                                [severity]="profile.metadata?.isFavorite ? 'danger' : 'secondary'" size="small"
                                [pTooltip]="profile.metadata?.isFavorite ? 'Remove from Favorites' : 'Add to Favorites'" />
                            <p-button [id]="'home-profile-' + i + '-clear-cookies-btn'"
                                (click)="clearCookies(profile, $event)" icon="pi pi-eraser" [rounded]="true"
                                [text]="true" severity="secondary" size="small" pTooltip="Clear cookies & cache" />
                            <p-button [id]="'home-profile-' + i + '-export-cookies-btn'"
                                (click)="exportCookies(profile, $event)" icon="pi pi-upload" [rounded]="true"
                                [text]="true" severity="secondary" size="small" pTooltip="Export cookies (JSON)"
                                [loading]="cookieExportingPath() === profile.path" />
                            <p-button [id]="'home-profile-' + i + '-import-cookies-btn'"
                                (click)="openCookieImportDialog(profile, $event)" icon="pi pi-file-import"
                                [rounded]="true" [text]="true" severity="secondary" size="small"
                                pTooltip="Import cookies" />
                            <p-button [id]="'home-profile-' + i + '-delete-btn'"
                                (click)="deleteProfile(profile, $event)" icon="pi pi-trash" [rounded]="true"
                                [text]="true" severity="danger" size="small" pTooltip="Delete profile" />
                            <p-button [id]="'home-profile-' + i + '-save-template-btn'"
                                (click)="openSaveTemplateDialog(profile, $event)" icon="pi pi-bookmark" [rounded]="true"
                                [text]="true" severity="secondary" size="small" pTooltip="Save as template" />
                            <p-button [id]="'home-profile-' + i + '-schedule-btn'"
                                (click)="openScheduleDialog(profile, $event)" icon="pi pi-calendar-clock"
                                [rounded]="true" [text]="true" severity="secondary" size="small"
                                pTooltip="Schedule launch" />
                        </div>
                    </td>
                </tr>
            </ng-template>

            <!-- Empty state -->
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td [attr.colspan]="columnConfig.visibleColumnCount()">No profiles in this folder</td>
                </tr>
            </ng-template>
        </p-table>


        } @else {
        <!-- Grid View -->
        <!-- Feature 6.7: Compact mode adds more columns -->
        <div id="home-profiles-grid" [class]="compactMode() 
                ? 'grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-2' 
                : 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4'" cdkDropList
            [cdkDropListDisabled]="sortBy() !== 'custom'" (cdkDropListDropped)="onProfileDrop($event)">
            @for (profile of paginatedProfiles(); track profile.path; let i = $index) {
            <div [id]="'home-profile-card-' + i"
                [class]="compactMode() 
                    ? 'border border-surface rounded-lg p-2 hover:border-primary/50 transition-all duration-300 cursor-pointer relative group shadow-sm hover:shadow-md'
                    : 'border border-surface rounded-xl p-4 hover:border-primary/50 transition-all duration-300 cursor-pointer relative group shadow-sm hover:shadow-md'"
                [class.hover:-translate-y-1]="sortBy() !== 'custom'" [class.cursor-grab]="sortBy() === 'custom'" cdkDrag
                [cdkDragDisabled]="sortBy() !== 'custom'" (click)="openEditDialog(profile, $event)"
                [pTooltip]="getProfileTooltip(profile)" tooltipPosition="top" [escape]="false">
                <!-- Drag Handle indicator (only in custom sort mode) -->
                @if (sortBy() === 'custom') {
                <div
                    class="absolute top-2 right-2 text-muted-color opacity-0 group-hover:opacity-100 transition-opacity">
                    <i class="pi pi-arrows-alt text-xs"></i>
                </div>
                }
                <!-- Phase 0: Proxy Indicator (Grid) -->
                @if (profile.metadata?.proxy) {
                @let gridGeo = getProxyGeoInfo(profile.metadata?.proxy);
                <div class="absolute top-2 right-2 z-10"
                    [class.right-8]="profile.metadata?.isPinned && sortBy() !== 'custom'">
                    <span
                        class="h-6 rounded-full bg-surface-0/80 dark:bg-surface-900/80 backdrop-blur-sm shadow-sm flex items-center justify-center border border-surface px-1.5 gap-1"
                        [pTooltip]="gridGeo ? gridGeo.label + ' - ' + profile.metadata?.proxy : 'Proxy: ' + profile.metadata?.proxy"
                        tooltipPosition="left">
                        @if (gridGeo) {
                        <span class="text-xs" role="img" [attr.aria-label]="gridGeo.label">{{ gridGeo.flag }}</span>
                        }
                        <i class="pi pi-globe text-primary text-xs"></i>
                    </span>
                </div>
                }
                <!-- Phase 1: Color indicator -->
                @if (profile.metadata?.color) {
                <div class="absolute top-2 left-2">
                    <span class="w-3 h-3 rounded-full inline-block"
                        [style.background-color]="profile.metadata?.color"></span>
                </div>
                }
                <!-- Pin indicator -->
                @if (profile.metadata?.isPinned && sortBy() !== 'custom') {
                <div class="absolute top-2 right-2">
                    <i class="pi pi-star-fill text-yellow-400 text-xs"></i>
                </div>
                }
                <!-- Phase 2: Hidden indicator -->
                @if (profile.metadata?.isHidden) {
                <div class="absolute top-2" [class]="profile.metadata?.color ? 'left-7' : 'left-2'">
                    <i class="pi pi-eye-slash text-muted-color text-xs"></i>
                </div>
                }
                <!-- Avatar/Emoji -->
                <div class="w-14 h-14 rounded-xl flex items-center justify-center mb-3 text-2xl"
                    [class]="profile.metadata?.isHidden ? 'opacity-50' : ''">
                    {{ getProfileDisplay(profile) }}
                </div>
                <!-- Name -->
                <h3 class="text-sm font-semibold text-color mb-1 truncate"
                    [class]="profile.metadata?.isHidden ? 'opacity-50' : ''">
                    {{ profile.name }}
                </h3>
                <!-- Tags -->
                @if (profile.metadata?.tags?.length) {
                <div class="flex flex-wrap gap-1 mb-2">
                    @for (tag of profile.metadata!.tags!.slice(0, 2); track tag) {
                    <span class="px-2 py-0.5 bg-primary/20 text-primary text-xs rounded">{{ tag }}</span>
                    }
                </div>
                }
                <!-- Actions -->
                <div class="flex items-center gap-2 mt-3 opacity-0 group-hover:opacity-100 transition-opacity">
                    <p-button (click)="launchProfile(profile, $event)" label="Start" size="small" class="flex-1" />
                    <button (click)="openDuplicateDialog(profile, $event)"
                        class="p-1.5 text-muted-color hover:text-primary transition-colors" title="Duplicate">
                        <i class="pi pi-copy text-sm"></i>
                    </button>
                    <button (click)="backupProfile(profile, $event)"
                        class="p-1.5 text-muted-color hover:text-primary transition-colors" title="Backup to ZIP">
                        <i class="pi pi-download text-sm"></i>
                    </button>
                    <!-- Feature 2.4: Favorites toggle -->
                    <button (click)="toggleFavorite(profile, $event)" [class]="profile.metadata?.isFavorite 
                            ? 'p-1.5 text-red-500 hover:text-red-400 transition-colors' 
                            : 'p-1.5 text-muted-color hover:text-red-500 transition-colors'"
                        [title]="profile.metadata?.isFavorite ? 'Remove from Favorites' : 'Add to Favorites'">
                        <i
                            [class]="profile.metadata?.isFavorite ? 'pi pi-heart-fill text-sm' : 'pi pi-heart text-sm'"></i>
                    </button>
                    <button (click)="deleteProfile(profile, $event)"
                        class="p-1.5 text-muted-color hover:text-error transition-colors" title="Delete">
                        <i class="pi pi-trash text-sm"></i>
                    </button>
                </div>

                <!-- CDK Drag Placeholder -->
                <div *cdkDragPlaceholder
                    class="border-2 border-dashed border-primary/50 rounded-xl bg-primary/5 h-full"></div>
            </div>
            }
        </div>
        }
        } @else {
        <!-- Other tabs placeholder -->
        <div id="home-tab-placeholder" class="flex flex-col items-center justify-center py-16 text-center">
            <div id="home-tab-placeholder-icon"
                class="w-16 h-16 rounded-xl border border-surface flex items-center justify-center mb-4">
                <i class="pi pi-cog text-2xl text-zinc-400"></i>
            </div>
            <h3 id="home-tab-placeholder-title" class="text-lg font-semibold text-color mb-2">
                {{ activeTab() |
                titlecase }}</h3>
            <p id="home-tab-placeholder-desc" class="text-sm text-muted-color">Coming soon...</p>
        </div>
        }
    </div>

    <!-- Bottom Bar (Always visible with paginator, actions appear when selection) -->
    @if (activeTab() === 'profiles' && filteredProfiles().length > 0) {
    <div id="home-bottom"
        class="shrink-0 border-t border-surface-100 dark:border-surface-800 px-4 py-3 min-h-[49px] sticky bottom-0 bg-surface-0 dark:bg-surface-900 z-10">
        <div class="flex items-center justify-between gap-4">
            <!-- Left: Actions (only when selection) -->
            @if (selectedProfiles().length > 0) {
            <div id="home-bottom-actions" class="flex items-center gap-2">
                <span id="home-bottom-selected-count" class="text-sm font-medium text-primary">
                    {{ selectedProfiles().length }} selected
                </span>
                <div class="w-px h-5 bg-border"></div>
                <button id="home-bottom-start-all-btn" (click)="bulkLaunch()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-primary text-primary hover:bg-primary hover:text-white transition-colors text-xs font-medium"
                    title="Launch all selected">
                    <i class="pi pi-play text-xs"></i>
                    <span class="hidden sm:inline">Launch</span>
                </button>
                <button id="home-bottom-export-btn" (click)="bulkExport()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-blue-500 text-blue-500 hover:bg-blue-500 hover:text-white transition-colors text-xs font-medium"
                    title="Export selected to ZIP">
                    <i class="pi pi-download text-xs"></i>
                    <span class="hidden sm:inline">Export</span>
                </button>
                <button id="home-bottom-tags-btn" (click)="openMassTagDialog()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-purple-500 text-purple-500 hover:bg-purple-500 hover:text-white transition-colors text-xs font-medium"
                    title="Assign tags to selected">
                    <i class="pi pi-tag text-xs"></i>
                    <span class="hidden sm:inline">Tags</span>
                </button>
                <button id="home-bottom-proxy-btn" (click)="openMassProxyDialog()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-teal-500 text-teal-500 hover:bg-teal-500 hover:text-white transition-colors text-xs font-medium"
                    title="Change proxy for selected">
                    <i class="pi pi-globe text-xs"></i>
                    <span class="hidden sm:inline">Proxy</span>
                </button>
                <button id="home-bottom-move-btn" (click)="openMassMoveDialog()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-amber-500 text-amber-500 hover:bg-amber-500 hover:text-white transition-colors text-xs font-medium"
                    title="Move selected to folder">
                    <i class="pi pi-folder text-xs"></i>
                    <span class="hidden sm:inline">Move</span>
                </button>
                <button id="home-bottom-cookies-btn" (click)="bulkExportCookies()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white transition-colors text-xs font-medium"
                    title="Export cookies from selected">
                    <i class="pi pi-file-export text-xs"></i>
                    <span class="hidden sm:inline">Cookies</span>
                </button>
                <button id="home-bottom-delete-btn" (click)="bulkDelete()"
                    class="h-7 flex items-center gap-1.5 px-2.5 rounded border border-error text-error hover:bg-error hover:text-white transition-colors text-xs font-medium"
                    title="Delete selected">
                    <i class="pi pi-trash text-xs"></i>
                    <span class="hidden sm:inline">Delete</span>
                </button>
                <button id="home-bottom-clear-btn" (click)="clearSelection()"
                    class="w-7 h-7 rounded border border-surface text-muted-color hover:text-color transition-colors flex items-center justify-center"
                    title="Clear selection">
                    <i class="pi pi-times text-xs"></i>
                </button>
            </div>
            } @else {
            <div></div>
            }

            <!-- Right: Minimal Paginator -->
            <div id="home-bottom-paginator" class="flex items-center gap-3 text-sm">
                <span class="text-muted-color">Rows per page:</span>
                <p-select
                    [options]="[{label: '10', value: 10}, {label: '25', value: 25}, {label: '50', value: 50}, {label: '100', value: 100}, {label: '500', value: 500}]"
                    [ngModel]="rowsPerPage()" (ngModelChange)="onRowsPerPageChange($event)" optionLabel="label"
                    optionValue="value" [style]="{'min-width': '5rem'}" />
                <span class="text-muted-color">{{ first() + 1 }}-{{ Math.min(first() + rowsPerPage(),
                    filteredProfiles().length) }} of {{ filteredProfiles().length }}</span>
                <div class="flex items-center">
                    <button (click)="onPagePrev()" [disabled]="first() === 0"
                        class="w-7 h-7 flex items-center justify-center text-muted-color hover:text-color disabled:opacity-30 disabled:cursor-not-allowed transition-colors">
                        <i class="pi pi-chevron-left text-xs"></i>
                    </button>
                    <button (click)="onPageNext()" [disabled]="first() + rowsPerPage() >= filteredProfiles().length"
                        class="w-7 h-7 flex items-center justify-center text-muted-color hover:text-color disabled:opacity-30 disabled:cursor-not-allowed transition-colors">
                        <i class="pi pi-chevron-right text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Create Profile Dialog -->
    <p-dialog id="home-create-dialog" header="Create New Profile" [(visible)]="showCreateDialog" [modal]="true"
        [style]="{ width: 'min(400px, 95vw)' }" [draggable]="false" [resizable]="false">
        <div id="home-create-dialog-content">
            <label for="home-create-dialog-name-input">Profile Name</label>
            <input pInputText id="home-create-dialog-name-input" type="text" [ngModel]="newProfileName()"
                (ngModelChange)="newProfileName.set($event)" placeholder="e.g., Work, Personal" class="w-full" />
        </div>
        <ng-template #footer>
            <p-button id="home-create-dialog-cancel-btn" label="Cancel" severity="secondary"
                (click)="showCreateDialog.set(false)" />
            <p-button id="home-create-dialog-submit-btn" label="Create" (click)="createProfile()" />
        </ng-template>
    </p-dialog>

    <!-- Rename Profile Dialog -->
    <p-dialog id="home-rename-dialog" header="Rename Profile" [(visible)]="showRenameDialog" [modal]="true"
        [style]="{ width: 'min(400px, 95vw)' }" [draggable]="false" [resizable]="false">
        <div id="home-rename-dialog-content">
            <label for="home-rename-dialog-name-input">New Name</label>
            <input pInputText id="home-rename-dialog-name-input" type="text" [ngModel]="renameProfileName()"
                (ngModelChange)="renameProfileName.set($event)" class="w-full" />
        </div>
        <ng-template #footer>
            <p-button id="home-rename-dialog-cancel-btn" label="Cancel" severity="secondary"
                (click)="showRenameDialog.set(false)" />
            <p-button id="home-rename-dialog-submit-btn" label="Rename" (click)="renameProfile()" />
        </ng-template>
    </p-dialog>

    <!-- Edit Profile Dialog -->
    <app-profile-edit-dialog [visible]="showEditDialog()" [profile]="selectedProfile()" [allProfiles]="profiles()"
        [availableBrowsers]="availableBrowsers()" [folders]="allFolders()" [proxyGroups]="proxyGroups()"
        [savedProxies]="proxyService.proxies()" (visibleChange)="showEditDialog.set($event)"
        (save)="onEditDialogSave($event)" #editDialog />

    <!-- Duplicate Profile Dialog -->
    <p-dialog id="home-duplicate-dialog" header="Duplicate Profile" [(visible)]="showDuplicateDialog" [modal]="true"
        [style]="{ width: 'min(400px, 95vw)' }" [draggable]="false" [resizable]="false">
        <div id="home-duplicate-dialog-content" class="py-2">
            <p class="text-sm text-muted-color mb-4">Create a copy of "{{ selectedProfile()?.name
                }}"</p>
            <label for="home-duplicate-dialog-name-input" class="block text-xs font-medium text-color mb-2">New
                Name</label>
            <input pInputText id="home-duplicate-dialog-name-input" type="text" [ngModel]="duplicateProfileName()"
                (ngModelChange)="duplicateProfileName.set($event)" class="w-full" />
        </div>
        <ng-template #footer>
            <div id="home-duplicate-dialog-footer" class="flex justify-end gap-3 pt-2">
                <p-button id="home-duplicate-dialog-cancel-btn" label="Cancel" severity="secondary"
                    (click)="showDuplicateDialog.set(false)" />
                <p-button id="home-duplicate-dialog-submit-btn" label="Duplicate" (click)="duplicateProfile()" />
            </div>
        </ng-template>
    </p-dialog>

    <!-- Phase 3: Activity Log Dialog -->
    <p-dialog id="home-activity-log-dialog" header="Activity Log" [(visible)]="showActivityLog" [modal]="true"
        [style]="{ width: 'min(500px, 95vw)', maxHeight: '70vh' }" [draggable]="false" [resizable]="false">
        <div id="home-activity-log-content" class="py-2">
            @if (activityLog.entries().length === 0) {
            <div class="flex flex-col items-center justify-center py-8 text-center">
                <i class="pi pi-history text-3xl text-muted-color mb-3"></i>
                <p class="text-muted-color">No activity recorded yet</p>
                <p class="text-xs text-muted-color mt-1">Launch, create, or delete profiles to see activity here</p>
            </div>
            } @else {
            <div class="space-y-2 max-h-[400px] overflow-y-auto">
                @for (entry of activityLog.entries(); track entry.id; let i = $index) {
                <div [id]="'home-activity-entry-' + i"
                    class="flex items-start gap-3 p-3 rounded-lg border border-surface hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                    <!-- Icon -->
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center shrink-0" [class]="{
                        'bg-green-500/20 text-green-500': entry.type === 'launch',
                        'bg-blue-500/20 text-blue-500': entry.type === 'create',
                        'bg-red-500/20 text-red-500': entry.type === 'delete',
                        'bg-purple-500/20 text-purple-500': entry.type === 'duplicate',
                        'bg-yellow-500/20 text-yellow-500': entry.type === 'edit'
                    }">
                        <i [class]="'pi ' + activityLog.getTypeIcon(entry.type)"></i>
                    </div>
                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <span class="font-medium text-color truncate">{{ entry.profileName }}</span>
                            <span
                                class="text-xs px-1.5 py-0.5 rounded bg-surface-100 dark:bg-surface-700 text-muted-color">{{
                                activityLog.getTypeLabel(entry.type) }}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1 text-xs text-muted-color">
                            <span>{{ activityLog.formatTimestamp(entry.timestamp) }}</span>
                            @if (entry.browser) {
                            <span>• {{ entry.browser | titlecase }}</span>
                            }
                            @if (entry.details) {
                            <span>• {{ entry.details }}</span>
                            }
                        </div>
                    </div>
                </div>
                }
            </div>
            }
        </div>
        <ng-template #footer>
            <div id="home-activity-log-footer" class="flex justify-between items-center pt-2">
                <p-button id="home-activity-log-clear-btn" label="Clear Log" severity="danger" [outlined]="true"
                    icon="pi pi-trash" (click)="activityLog.clearLog()"
                    [disabled]="activityLog.entries().length === 0" />
                <p-button id="home-activity-log-close-btn" label="Close" severity="secondary"
                    (click)="showActivityLog.set(false)" />
            </div>
        </ng-template>
    </p-dialog>

    <!-- Create Folder Dialog -->
    <p-dialog [(visible)]="showCreateFolderDialog" header="Create Folder" [modal]="true" [style]="{ width: '400px' }"
        [draggable]="false" [resizable]="false">
        <div class="flex flex-col gap-4">
            <div class="flex flex-col gap-2">
                <label for="folderName" class="font-medium">Folder Name</label>
                <input pInputText id="folderName" [(ngModel)]="newFolderName" (keydown.enter)="createFolder()"
                    autofocus />
            </div>
            <!-- Icon Selector -->
            <div class="flex flex-col gap-2">
                <label class="font-medium">Icon</label>
                <div class="flex flex-wrap gap-2">
                    @for (icon of folderIcons; track icon) {
                    <button type="button"
                        class="w-8 h-8 rounded-md border flex items-center justify-center transition-all cursor-pointer"
                        [class]="newFolderIcon() === icon
                            ? 'border-primary bg-primary/10 text-primary ring-2 ring-primary/30'
                            : 'border-surface-100 dark:border-surface-800 text-muted-color hover:border-primary/50'"
                        (click)="newFolderIcon.set(icon)" [pTooltip]="icon">
                        <i [class]="'pi ' + icon + ' text-sm'"></i>
                    </button>
                    }
                </div>
            </div>
            <!-- Color Selector -->
            <div class="flex flex-col gap-2">
                <label class="font-medium">Color</label>
                <div class="flex flex-wrap gap-2">
                    @for (color of folderColors; track color) {
                    <button type="button" class="w-7 h-7 rounded-full border-2 transition-all cursor-pointer" [class]="newFolderColor() === color
                            ? 'ring-2 ring-offset-2 ring-offset-surface-0 dark:ring-offset-surface-900 scale-110'
                            : 'hover:scale-110'" [style.background-color]="color"
                        [style.border-color]="newFolderColor() === color ? color : 'transparent'"
                        (click)="newFolderColor.set(color)">
                    </button>
                    }
                    <!-- No color option -->
                    <button type="button"
                        class="w-7 h-7 rounded-full border-2 border-surface-100 dark:border-surface-800 transition-all cursor-pointer flex items-center justify-center"
                        [class]="!newFolderColor() ? 'ring-2 ring-offset-2 ring-primary' : 'hover:scale-110'"
                        (click)="newFolderColor.set('')" pTooltip="No color">
                        <i class="pi pi-ban text-xs text-muted-color"></i>
                    </button>
                </div>
            </div>
        </div>
        <ng-template pTemplate="footer">
            <p-button label="Cancel" (click)="showCreateFolderDialog.set(false)" [text]="true" severity="secondary" />
            <p-button label="Create" (click)="createFolder()" [disabled]="!newFolderName().trim()" />
        </ng-template>
    </p-dialog>

    <!-- Manage Folders Dialog -->
    <p-dialog [(visible)]="showManageFoldersDialog" header="Manage Folders" [modal]="true" [style]="{ width: '500px' }"
        [draggable]="false" [resizable]="false">
        <div class="flex flex-col gap-2">
            <div class="text-muted-color text-sm mb-2">Custom folders only. System folders cannot be changed.</div>

            @if (allFolders().length === 0) {
            <div class="text-center p-4 text-muted-color">No custom folders.</div>
            }

            <div class="flex flex-col gap-2 max-h-[60vh] overflow-y-auto">
                @for (folder of allFolders(); track folder.id) {
                @if (!folderService.isSystemFolder(folder.id)) {
                <div
                    class="flex items-center justify-between p-3 border border-surface-100 dark:border-surface-800 rounded-lg bg-surface-50 dark:bg-surface-900">
                    @if (editingFolderId() === folder.id) {
                    <div class="flex items-center gap-2 flex-1 mr-2">
                        <input pInputText [(ngModel)]="editFolderName" class="w-full p-inputtext-sm"
                            (keydown.enter)="saveEditFolder()" />
                    </div>
                    <!-- Inline icon/color editor -->
                    <div class="flex items-center gap-2 flex-1 mr-2 mt-2">
                        <div class="flex flex-wrap gap-1">
                            @for (icon of folderIcons; track icon) {
                            <button type="button"
                                class="w-6 h-6 rounded flex items-center justify-center transition-all cursor-pointer text-xs"
                                [class]="editFolderIcon() === icon
                                    ? 'bg-primary/10 text-primary ring-1 ring-primary/50'
                                    : 'text-muted-color hover:text-color'" (click)="editFolderIcon.set(icon)">
                                <i [class]="'pi ' + icon"></i>
                            </button>
                            }
                        </div>
                        <div class="border-l border-surface-100 dark:border-surface-800 h-5 mx-1"></div>
                        <div class="flex flex-wrap gap-1">
                            @for (color of folderColors; track color) {
                            <button type="button" class="w-5 h-5 rounded-full transition-all cursor-pointer"
                                [class]="editFolderColor() === color ? 'ring-2 ring-offset-1 scale-110' : 'hover:scale-110'"
                                [style.background-color]="color" (click)="editFolderColor.set(color)">
                            </button>
                            }
                            <button type="button"
                                class="w-5 h-5 rounded-full border border-surface-100 dark:border-surface-800 flex items-center justify-center cursor-pointer"
                                [class]="!editFolderColor() ? 'ring-2 ring-offset-1 ring-primary' : ''"
                                (click)="editFolderColor.set('')">
                                <i class="pi pi-ban text-[8px] text-muted-color"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <p-button icon="pi pi-check" [text]="true" [rounded]="true" severity="success"
                            (click)="saveEditFolder()" />
                        <p-button icon="pi pi-times" [text]="true" [rounded]="true" severity="secondary"
                            (click)="cancelEditFolder()" />
                    </div>
                    } @else {
                    <div class="flex items-center gap-3 flex-1 overflow-hidden">
                        <i [class]="'pi ' + (folder.icon || 'pi-folder')" [style.color]="folder.color"></i>
                        <span class="font-medium truncate">{{ folder.name }}</span>
                        <span class="text-xs text-muted-color">({{ folder.profileCount || 0 }})</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <p-button icon="pi pi-pencil" [text]="true" [rounded]="true" severity="secondary"
                            (click)="startEditFolder(folder)" />
                        <p-button icon="pi pi-trash" [text]="true" [rounded]="true" severity="danger"
                            (click)="deleteFolder(folder.id)" />
                    </div>
                    }
                </div>
                }
                }
            </div>
        </div>
        <ng-template pTemplate="footer">
            <p-button label="Close" (click)="showManageFoldersDialog.set(false)" [text]="true" />
            <p-button icon="pi pi-plus" label="New Folder" (click)="onAddFolder()" [text]="true" severity="info" />
        </ng-template>
    </p-dialog>

    <!-- Feature 12.1: Mass Tag Assign Dialog -->
    <p-dialog id="home-mass-tag-dialog" header="Assign Tags to Selected Profiles" [(visible)]="showMassTagDialog"
        [modal]="true" [style]="{ width: 'min(480px, 95vw)' }" [draggable]="false" [resizable]="false">
        <div id="home-mass-tag-content" class="py-2">
            <p class="text-sm text-muted-color mb-4">
                Select tags to apply to {{ selectedProfiles().length }} selected profile(s).
                Tags will be merged with existing tags.
            </p>

            <!-- Existing Tags -->
            @if (availableTags().length > 0) {
            <div class="mb-4">
                <label class="block text-xs font-medium text-color mb-2">Existing Tags</label>
                <div class="flex flex-wrap gap-2">
                    @for (tag of availableTags(); track tag) {
                    <button [id]="'home-mass-tag-chip-' + tag" (click)="toggleMassTag(tag)"
                        [class]="massTagSelection().includes(tag) 
                            ? 'px-3 py-1.5 rounded-lg text-sm font-medium bg-primary text-white border border-primary transition-all duration-200 shadow-sm'
                            : 'px-3 py-1.5 rounded-lg text-sm font-medium bg-surface-100 dark:bg-surface-800 text-color border border-surface-100 dark:border-surface-800 hover:border-primary/50 transition-all duration-200'">
                        <i class="pi pi-tag text-xs mr-1.5"></i>{{ tag }}
                    </button>
                    }
                </div>
            </div>
            }

            <!-- Selected Tags Preview -->
            @if (massTagSelection().length > 0) {
            <div class="mb-4 p-3 bg-primary/10 border border-primary/30 rounded-lg">
                <div class="flex items-center gap-2 flex-wrap">
                    <span class="text-xs font-medium text-primary">Will apply:</span>
                    @for (tag of massTagSelection(); track tag) {
                    <span
                        class="inline-flex items-center gap-1 px-2 py-0.5 bg-primary/20 text-primary text-xs rounded-full">
                        {{ tag }}
                        <button (click)="toggleMassTag(tag)" class="hover:text-red-500 transition-colors">
                            <i class="pi pi-times text-[10px]"></i>
                        </button>
                    </span>
                    }
                </div>
            </div>
            }

            <!-- Create New Tag -->
            <div>
                <label for="home-mass-tag-new-input" class="block text-xs font-medium text-color mb-2">Create New
                    Tag</label>
                <div class="flex gap-2">
                    <input pInputText id="home-mass-tag-new-input" type="text" [ngModel]="newMassTag()"
                        (ngModelChange)="newMassTag.set($event)" (keydown.enter)="addNewMassTag()"
                        placeholder="Type and press Enter" class="flex-1" />
                    <p-button icon="pi pi-plus" (click)="addNewMassTag()" [disabled]="!newMassTag().trim()" />
                </div>
            </div>
        </div>
        <ng-template #footer>
            <p-button id="home-mass-tag-cancel-btn" label="Cancel" severity="secondary"
                (click)="showMassTagDialog.set(false)" />
            <p-button id="home-mass-tag-apply-btn" label="Apply Tags" icon="pi pi-check" (click)="bulkAssignTags()"
                [disabled]="massTagSelection().length === 0" />
        </ng-template>
    </p-dialog>

    <!-- Feature 12.2: Mass Proxy Change Dialog -->
    <p-dialog id="home-mass-proxy-dialog" header="Change Proxy for Selected Profiles" [(visible)]="showMassProxyDialog"
        [modal]="true" [style]="{ width: 'min(480px, 95vw)' }" [draggable]="false" [resizable]="false">
        <div id="home-mass-proxy-content" class="py-2">
            <p class="text-sm text-muted-color mb-4">
                Apply proxy to {{ selectedProfiles().length }} selected profile(s).
            </p>

            <!-- Mode selector -->
            <div class="flex gap-2 mb-4">
                <button id="home-mass-proxy-mode-saved" (click)="massProxyMode.set('saved')"
                    [class]="massProxyMode() === 'saved'
                        ? 'flex-1 px-3 py-2 rounded-lg text-sm font-medium bg-primary text-white border border-primary transition-all'
                        : 'flex-1 px-3 py-2 rounded-lg text-sm font-medium bg-surface-100 dark:bg-surface-800 text-color border border-surface-100 dark:border-surface-800 hover:border-primary/50 transition-all'">
                    <i class="pi pi-list text-xs mr-1.5"></i>Use Saved Proxy
                </button>
                <button id="home-mass-proxy-mode-none" (click)="massProxyMode.set('none')"
                    [class]="massProxyMode() === 'none'
                        ? 'flex-1 px-3 py-2 rounded-lg text-sm font-medium bg-red-500 text-white border border-red-500 transition-all'
                        : 'flex-1 px-3 py-2 rounded-lg text-sm font-medium bg-surface-100 dark:bg-surface-800 text-color border border-surface-100 dark:border-surface-800 hover:border-red-500/50 transition-all'">
                    <i class="pi pi-ban text-xs mr-1.5"></i>Clear Proxy
                </button>
            </div>

            <!-- Saved proxy selector -->
            @if (massProxyMode() === 'saved') {
            <div class="mb-4">
                <label for="home-mass-proxy-select" class="block text-xs font-medium text-color mb-2">Select
                    Proxy</label>
                <p-select id="home-mass-proxy-select" [options]="proxyService.proxies()"
                    [ngModel]="massProxySelectedId()" (ngModelChange)="massProxySelectedId.set($event)"
                    optionLabel="name" optionValue="id" placeholder="Choose a saved proxy..." class="w-full">
                    <ng-template pTemplate="selectedItem" let-item>
                        @if (item) {
                        <div class="flex items-center gap-2">
                            <i class="pi pi-globe text-primary text-xs"></i>
                            <span class="font-mono text-sm">{{ item.host }}:{{ item.port }}</span>
                            <span class="text-xs text-muted-color uppercase">{{ item.type }}</span>
                        </div>
                        }
                    </ng-template>
                    <ng-template pTemplate="item" let-item>
                        <div class="flex items-center gap-2">
                            <i class="pi pi-globe text-primary text-xs"></i>
                            <span class="font-mono text-sm">{{ item.host }}:{{ item.port }}</span>
                            <span class="text-xs text-muted-color uppercase">{{ item.type }}</span>
                            @if (item.group) {
                            <span class="text-xs px-1.5 py-0.5 bg-surface-100 dark:bg-surface-700 rounded">{{ item.group
                                }}</span>
                            }
                        </div>
                    </ng-template>
                </p-select>
            </div>
            }

            <!-- Clear proxy warning -->
            @if (massProxyMode() === 'none') {
            <div class="mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg">
                <div class="flex items-center gap-2">
                    <i class="pi pi-exclamation-triangle text-red-500"></i>
                    <span class="text-sm text-color">This will remove the proxy from all selected profiles.</span>
                </div>
            </div>
            }
        </div>
        <ng-template #footer>
            <p-button id="home-mass-proxy-cancel-btn" label="Cancel" severity="secondary"
                (click)="showMassProxyDialog.set(false)" />
            <p-button id="home-mass-proxy-apply-btn"
                [label]="massProxyMode() === 'none' ? 'Clear Proxy' : 'Apply Proxy'"
                [icon]="massProxyMode() === 'none' ? 'pi pi-ban' : 'pi pi-check'"
                [severity]="massProxyMode() === 'none' ? 'danger' : 'primary'" (click)="bulkAssignProxy()"
                [loading]="bulkProxyLoading()" [disabled]="massProxyMode() === 'saved' && !massProxySelectedId()" />
        </ng-template>
    </p-dialog>

    <!-- Mass Move to Folder Dialog -->
    <p-dialog id="home-mass-move-dialog" header="Move to Folder" [visible]="showMassMoveDialog()"
        (visibleChange)="showMassMoveDialog.set($event)" [modal]="true" [style]="{ width: '400px' }" [closable]="true">
        <div class="flex flex-col gap-3 pt-2">
            <p class="text-sm text-muted-color">
                Move {{ selectedProfiles().length }} selected profile(s) to:
            </p>
            <div class="flex flex-col gap-1.5 max-h-64 overflow-y-auto">
                <!-- No folder option -->
                <button id="home-mass-move-none"
                    class="flex items-center gap-2.5 px-3 py-2 rounded-lg text-left transition-colors text-sm" [class]="massMoveTargetFolderId() === null
                        ? 'bg-primary/10 text-primary border border-primary/30'
                        : 'hover:bg-surface-100 dark:hover:bg-surface-800 text-color'"
                    (click)="massMoveTargetFolderId.set(null)">
                    <i class="pi pi-times-circle text-muted-color"></i>
                    <span>No Folder (remove from folder)</span>
                </button>
                @for (folder of folderService.customFolders(); track folder.id) {
                <button [id]="'home-mass-move-folder-' + folder.id"
                    class="flex items-center gap-2.5 px-3 py-2 rounded-lg text-left transition-colors text-sm" [class]="massMoveTargetFolderId() === folder.id
                        ? 'bg-primary/10 text-primary border border-primary/30'
                        : 'hover:bg-surface-100 dark:hover:bg-surface-800 text-color'"
                    (click)="massMoveTargetFolderId.set(folder.id)">
                    <i class="pi" [class]="folder.icon || 'pi-folder'" [style.color]="folder.color || 'inherit'"></i>
                    <span>{{ folder.name }}</span>
                    <span class="ml-auto text-xs text-muted-color">{{ folder.profileCount }} profiles</span>
                </button>
                }
            </div>
            @if (folderService.customFolders().length === 0) {
            <p class="text-xs text-muted-color italic">No custom folders yet. Create folders in the sidebar first.</p>
            }
        </div>
        <ng-template #footer>
            <p-button label="Cancel" severity="secondary" (click)="showMassMoveDialog.set(false)" />
            <p-button id="home-mass-move-apply-btn" label="Move" icon="pi pi-folder" (click)="bulkMoveToFolder()"
                [loading]="bulkMoveLoading()" />
        </ng-template>
    </p-dialog>

    <!-- Schedule Launch Dialog -->
    <p-dialog id="home-schedule-dialog" header="Schedule Launch" [visible]="showScheduleDialog()"
        (visibleChange)="showScheduleDialog.set($event)" [modal]="true" [style]="{ width: '440px' }" [closable]="true">
        <div class="flex flex-col gap-4 pt-2">
            <p class="text-sm text-muted-color">
                Schedule auto-launch for <strong>{{ scheduleProfileName() }}</strong>
            </p>

            <!-- Recurrence -->
            <div>
                <label class="block text-xs font-medium text-color mb-2">Recurrence</label>
                <div class="flex gap-2 flex-wrap">
                    @for (opt of scheduleRecurrenceOptions; track opt.value) {
                    <button [id]="'home-schedule-rec-' + opt.value"
                        class="px-3 py-1.5 rounded-lg text-xs font-medium border transition-colors" [class]="scheduleRecurrence() === opt.value
                            ? 'bg-primary/10 text-primary border-primary/30'
                            : 'border-surface-100 dark:border-surface-800 text-muted-color hover:text-color'"
                        (click)="scheduleRecurrence.set(opt.value)">
                        {{ opt.label }}
                    </button>
                    }
                </div>
            </div>

            <!-- Time Picker -->
            <div>
                <label for="home-schedule-time" class="block text-xs font-medium text-color mb-2">Time</label>
                <input pInputText id="home-schedule-time" type="time" [ngModel]="scheduleTime()"
                    (ngModelChange)="scheduleTime.set($event)" class="w-full" />
            </div>

            <!-- Date for one-time -->
            @if (scheduleRecurrence() === 'once') {
            <div>
                <label for="home-schedule-date" class="block text-xs font-medium text-color mb-2">Date</label>
                <input pInputText id="home-schedule-date" type="date" [ngModel]="scheduleDate()"
                    (ngModelChange)="scheduleDate.set($event)" class="w-full" />
            </div>
            }

            <!-- Custom days -->
            @if (scheduleRecurrence() === 'custom') {
            <div>
                <label class="block text-xs font-medium text-color mb-2">Days</label>
                <div class="flex gap-1.5">
                    @for (day of dayNames; track day.index) {
                    <button [id]="'home-schedule-day-' + day.index"
                        class="w-9 h-9 rounded-full text-xs font-medium border transition-colors" [class]="scheduleCustomDays().includes(day.index)
                            ? 'bg-primary text-white border-primary'
                            : 'border-surface-100 dark:border-surface-800 text-muted-color'"
                        (click)="toggleScheduleDay(day.index)">
                        {{ day.short }}
                    </button>
                    }
                </div>
            </div>
            }

            <!-- Existing schedules for this profile -->
            @if (profileSchedules().length > 0) {
            <div class="border-t border-surface-100 dark:border-surface-800 pt-3">
                <label class="block text-xs font-medium text-color mb-2">Existing Schedules</label>
                @for (sch of profileSchedules(); track sch.id) {
                <div
                    class="flex items-center gap-2 px-3 py-2 rounded-lg bg-surface-50 dark:bg-surface-800 mb-1.5 text-sm">
                    <span class="flex-1">{{ sch.time }} — {{ sch.recurrence }}</span>
                    <button class="text-xs text-muted-color hover:text-color cursor-pointer"
                        (click)="scheduleService.toggle(sch.id)">
                        <i [class]="sch.enabled ? 'pi pi-pause-circle' : 'pi pi-play-circle'"></i>
                    </button>
                    <button class="text-xs text-error hover:text-red-700 cursor-pointer"
                        (click)="scheduleService.remove(sch.id)">
                        <i class="pi pi-trash"></i>
                    </button>
                </div>
                }
            </div>
            }
        </div>
        <ng-template #footer>
            <p-button label="Cancel" severity="secondary" (click)="showScheduleDialog.set(false)" />
            <p-button id="home-schedule-add-btn" label="Add Schedule" icon="pi pi-calendar-plus" (click)="addSchedule()"
                [disabled]="!scheduleTime()" />
        </ng-template>
    </p-dialog>

    <!-- Bulk Create Dialog -->
    <p-dialog id="home-bulk-create-dialog" header="Bulk Create Profiles" [(visible)]="showBulkCreateDialog"
        [modal]="true" [style]="{ width: '440px' }" [closable]="true">
        <div class="flex flex-col gap-4 pt-2">
            <div>
                <label for="home-bulk-prefix" class="block text-xs font-medium text-color mb-2">Name Prefix</label>
                <input pInputText id="home-bulk-prefix" type="text" [ngModel]="bulkPrefix()"
                    (ngModelChange)="bulkPrefix.set($event)" placeholder="Profile" class="w-full" />
            </div>
            <div class="flex gap-4">
                <div class="flex-1">
                    <label for="home-bulk-count" class="block text-xs font-medium text-color mb-2">Count</label>
                    <input pInputText id="home-bulk-count" type="number" [ngModel]="bulkCount()"
                        (ngModelChange)="bulkCount.set($event)" min="1" max="500" class="w-full" />
                </div>
                <div class="flex-1">
                    <label for="home-bulk-start" class="block text-xs font-medium text-color mb-2">Start Number</label>
                    <input pInputText id="home-bulk-start" type="number" [ngModel]="bulkStartNum()"
                        (ngModelChange)="bulkStartNum.set($event)" min="1" class="w-full" />
                </div>
            </div>
            @if (bulkPreview(); as preview) {
            <div
                class="text-xs text-surface-500 dark:text-surface-400 bg-surface-50 dark:bg-surface-800 rounded-lg p-3">
                <span class="font-medium">Preview:</span> {{ preview }}
            </div>
            }
        </div>
        <ng-template #footer>
            <p-button id="home-bulk-cancel-btn" label="Cancel" severity="secondary"
                (click)="showBulkCreateDialog.set(false)" />
            <p-button id="home-bulk-create-btn" label="Create" icon="pi pi-plus" (click)="bulkCreateProfiles()"
                [loading]="bulkCreating()" [disabled]="!bulkPrefix() || bulkCount() < 1" />
        </ng-template>
    </p-dialog>

    <!-- Save as Template Dialog -->
    <p-dialog id="home-save-template-dialog" header="Save as Template" [(visible)]="showSaveTemplateDialog"
        [modal]="true" [style]="{ width: '400px' }" [closable]="true">
        <div class="flex flex-col gap-3 pt-2">
            <div class="text-sm text-surface-500 dark:text-surface-400">
                Save "{{ templateSourceProfile()?.name }}" as a reusable template
            </div>
            <div>
                <label for="home-template-name" class="block text-xs font-medium text-color mb-2">Template Name</label>
                <input pInputText id="home-template-name" type="text" [ngModel]="templateName()"
                    (ngModelChange)="templateName.set($event)" class="w-full" (keydown.enter)="saveAsTemplate()" />
            </div>
        </div>
        <ng-template #footer>
            <p-button id="home-template-cancel-btn" label="Cancel" severity="secondary"
                (click)="showSaveTemplateDialog.set(false)" />
            <p-button id="home-template-save-btn" label="Save Template" icon="pi pi-bookmark" (click)="saveAsTemplate()"
                [loading]="templateSaving()" [disabled]="!templateName()" />
        </ng-template>
    </p-dialog>

    <!-- Create from Template Dialog -->
    <p-dialog id="home-create-from-template-dialog" header="Create from Template"
        [(visible)]="showCreateFromTemplateDialog" [modal]="true" [style]="{ width: '480px' }" [closable]="true">
        <div class="flex flex-col gap-4 pt-2">
            @if (availableTemplates().length === 0) {
            <div class="text-center py-6 text-surface-500 dark:text-surface-400">
                <i class="pi pi-bookmark text-3xl mb-2"></i>
                <p class="text-sm">No templates yet. Save a profile as template first.</p>
            </div>
            } @else {
            <div>
                <label class="block text-xs font-medium text-color mb-2">Select Template</label>
                <div class="flex flex-col gap-1 max-h-48 overflow-y-auto">
                    @for (tpl of availableTemplates(); track tpl.path) {
                    <div class="flex items-center justify-between p-2 rounded-lg cursor-pointer transition-colors"
                        [class]="selectedTemplatePath() === tpl.path
                                    ? 'bg-primary/10 border border-primary'
                                    : 'bg-surface-50 dark:bg-surface-800 border border-transparent hover:bg-surface-100 dark:hover:bg-surface-700'"
                        (click)="selectedTemplatePath.set(tpl.path)">
                        <div class="flex items-center gap-2">
                            <i class="pi pi-bookmark text-sm"></i>
                            <span class="text-sm">{{ tpl.name }}</span>
                        </div>
                        <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" size="small"
                            (click)="deleteTemplate(tpl); $event.stopPropagation()" />
                    </div>
                    }
                </div>
            </div>
            <div>
                <label for="home-from-template-name" class="block text-xs font-medium text-color mb-2">New Profile
                    Name</label>
                <input pInputText id="home-from-template-name" type="text" [ngModel]="newFromTemplateName()"
                    (ngModelChange)="newFromTemplateName.set($event)" class="w-full" placeholder="Enter profile name"
                    (keydown.enter)="createFromTemplate()" />
            </div>
            }
        </div>
        <ng-template #footer>
            <p-button id="home-from-template-cancel-btn" label="Cancel" severity="secondary"
                (click)="showCreateFromTemplateDialog.set(false)" />
            @if (availableTemplates().length > 0) {
            <p-button id="home-from-template-create-btn" label="Create" icon="pi pi-plus" (click)="createFromTemplate()"
                [loading]="templateCreating()" [disabled]="!selectedTemplatePath() || !newFromTemplateName()" />
            }
        </ng-template>
    </p-dialog>

    <!-- Column Settings Panel -->
    <app-column-settings-panel [visible]="showColumnSettings()" (visibleChange)="showColumnSettings.set($event)" />

    <!-- Cookie Import Dialog -->
    <p-dialog id="home-cookie-import-dialog" header="Import Cookies" [(visible)]="showCookieImportDialog" [modal]="true"
        [style]="{ width: '550px' }" [draggable]="false" [closable]="true">
        <div class="flex flex-col gap-4">
            <p class="text-sm text-surface-500 dark:text-surface-400">
                Paste cookie JSON (EditThisCookie / Cookie-Editor format) or import from file.
                Profile: <strong>{{ cookieImportTarget()?.name }}</strong>
            </p>
            <div class="flex justify-end">
                <p-button id="home-cookie-import-file-btn" label="Load from File" icon="pi pi-folder-open"
                    severity="secondary" size="small"
                    (click)="cookieImportTarget() && importCookiesFromFile(cookieImportTarget()!, $event)" />
            </div>
            <textarea id="home-cookie-import-textarea" rows="12" [ngModel]="cookieImportJson()"
                (ngModelChange)="cookieImportJson.set($event)"
                placeholder='[{"name":"session","value":"abc123","domain":".example.com","path":"/","expires":1700000000,"httpOnly":true,"secure":true}]'
                class="w-full p-3 rounded-lg border border-surface-100 dark:border-surface-800 bg-surface-0 dark:bg-surface-800 text-surface-900 dark:text-surface-0 font-mono text-xs resize-y outline-none focus:border-primary">
            </textarea>
        </div>
        <ng-template #footer>
            <p-button id="home-cookie-import-cancel-btn" label="Cancel" severity="secondary"
                (click)="showCookieImportDialog.set(false)" />
            <p-button id="home-cookie-import-confirm-btn" label="Import Cookies" icon="pi pi-check"
                (click)="importCookiesConfirm()" [loading]="cookieImportLoading()"
                [disabled]="!cookieImportJson().trim()" />
        </ng-template>
    </p-dialog>
</div>