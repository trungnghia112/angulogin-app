<div id="home-container" class="flex flex-col h-full min-h-0 overflow-hidden bg-bg">
    <!-- Header Toolbar - matches header height -->
    <header id="home-header" data-tauri-drag-region
        class="flex items-center gap-4 px-6 h-(--spacing-header) shrink-0 border-b border-border">
        <!-- Search -->
        <div id="home-header-search" class="flex-1 max-w-md">
            <div class="relative">
                <i class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500 text-sm"></i>
                <input id="home-header-search-input" pInputText type="text" placeholder="Search"
                    class="w-full bg-surface border border-border rounded-lg pl-9 pr-4 py-2.5 text-zinc-50 text-sm placeholder-zinc-600 focus:border-primary focus:ring-1 focus:ring-primary/30 outline-none transition-all" />
            </div>
        </div>

        <!-- Actions -->
        <div id="home-header-actions" class="flex items-center gap-2 ml-auto">
            <button id="home-header-refresh-btn"
                class="flex items-center gap-2 px-3 py-2.5 bg-surface border border-border rounded-lg text-zinc-300 text-sm hover:bg-surface-hover transition-colors">
                <i class="pi pi-refresh text-sm"></i>
                <span>Refresh</span>
            </button>
            <button id="home-header-filters-btn"
                class="flex items-center gap-2 px-3 py-2.5 bg-surface border border-border rounded-lg text-zinc-300 text-sm hover:bg-surface-hover transition-colors">
                <i class="pi pi-filter text-sm"></i>
                <span>Filters</span>
            </button>
            <button id="home-header-create-btn" pButton (click)="openCreateDialog()"
                class="flex items-center gap-2 px-4 py-2.5 bg-primary border-none rounded-lg text-bg text-sm font-semibold cursor-pointer hover:bg-primary-hover transition-colors">
                <i class="pi pi-plus"></i>
                <span>Create profile</span>
            </button>
        </div>
    </header>

    <!-- Tabs -->
    <div id="home-tabs" class="flex items-center justify-between px-6 py-3 border-b border-border">
        <nav id="home-tabs-nav" class="flex items-center gap-6">
            @for (tab of tabs; track tab.key; let i = $index) {
            <button [id]="'home-tab-' + i"
                class="flex items-center gap-2 pb-2 text-sm font-medium transition-colors border-b-2 -mb-[13px]"
                [class]="activeTab() === tab.key
            ? 'text-zinc-50 border-primary'
            : 'text-zinc-500 border-transparent hover:text-zinc-300'" (click)="setActiveTab(tab.key)">
                <i [class]="'pi ' + tab.icon + ' text-sm'"></i>
                <span>{{ tab.label }}</span>
            </button>
            }
        </nav>
        <span id="home-tabs-usage" class="text-sm text-zinc-500">{{ profilesUsed() }} of {{ maxProfiles() }} profiles
            used</span>
    </div>

    <!-- Content -->
    <div id="home-content" class="flex-1 overflow-auto p-6">
        @if (loading()) {
        <div id="home-loading" class="flex flex-col items-center justify-center py-16 gap-4 text-zinc-500">
            <p-progressSpinner strokeWidth="3" />
            <p>Scanning profiles...</p>
        </div>
        } @else if (profiles().length === 0) {
        <div id="home-empty" class="flex flex-col items-center justify-center py-16 text-center">
            <div id="home-empty-icon"
                class="w-20 h-20 rounded-2xl bg-surface border border-border flex items-center justify-center mb-5">
                <i class="pi pi-inbox text-3xl text-zinc-500"></i>
            </div>
            <h3 id="home-empty-title" class="text-lg font-semibold text-zinc-50 mb-2">No Profiles Found</h3>
            <p id="home-empty-desc" class="text-sm text-zinc-500">Enter the path to your Chrome profiles folder and
                click Scan</p>
        </div>
        } @else if (activeTab() === 'profiles') {
        <!-- Profiles Table -->
        <div id="home-profiles-table" class="bg-surface border border-border rounded-xl overflow-hidden">
            <p-table [value]="filteredProfiles()" [(selection)]="selectedProfiles"
                (selectionChange)="onSelectionChange($event)" [first]="first()" [rows]="rowsPerPage()" dataKey="path"
                [tableStyle]="{ 'min-width': '60rem' }" class="profile-table">

                <!-- Header -->
                <ng-template pTemplate="header">
                    <tr id="home-profiles-table-header" class="border-b border-border">
                        <th class="w-12 bg-surface-hover/50 p-4">
                            <p-tableHeaderCheckbox />
                        </th>
                        <th
                            class="bg-surface-hover/50 p-4 text-left text-xs font-semibold text-zinc-400 uppercase tracking-wide">
                            Name</th>
                        <th
                            class="bg-surface-hover/50 p-4 text-left text-xs font-semibold text-zinc-400 uppercase tracking-wide">
                            Status</th>
                        <th
                            class="bg-surface-hover/50 p-4 text-left text-xs font-semibold text-zinc-400 uppercase tracking-wide">
                            Proxy</th>
                        <th
                            class="bg-surface-hover/50 p-4 text-left text-xs font-semibold text-zinc-400 uppercase tracking-wide">
                            Tags</th>
                        <th
                            class="bg-surface-hover/50 p-4 text-left text-xs font-semibold text-zinc-400 uppercase tracking-wide">
                            Notes</th>
                        <th class="w-12 bg-surface-hover/50 p-4">
                            <i class="pi pi-cog text-zinc-500"></i>
                        </th>
                    </tr>
                </ng-template>

                <!-- Body -->
                <ng-template pTemplate="body" let-profile let-i="rowIndex">
                    <tr [id]="'home-profile-row-' + i"
                        class="border-b border-border hover:bg-surface-hover/30 transition-colors cursor-pointer"
                        (click)="openEditDialog(profile, $event)">
                        <!-- Checkbox -->
                        <td class="p-4">
                            <p-tableCheckbox [value]="profile" />
                        </td>

                        <!-- Name with Start button -->
                        <td class="p-4">
                            <div class="flex items-center gap-3">
                                <button [id]="'home-profile-' + i + '-start-btn'"
                                    (click)="launchProfile(profile, $event)"
                                    class="flex items-center gap-2 px-3 py-1.5 bg-primary/20 border border-primary/40 rounded-md text-primary text-xs font-semibold hover:bg-primary hover:text-bg transition-colors">
                                    <i [class]="'pi ' + getOsIcon(profile) + ' text-xs'"></i>
                                    <span>Start</span>
                                </button>
                                <span class="font-medium text-zinc-50">{{ profile.name }}</span>
                            </div>
                        </td>

                        <!-- Status -->
                        <td class="p-4">
                            <span
                                class="px-2.5 py-1 bg-surface-hover border border-border rounded text-xs text-zinc-400">
                                No status
                            </span>
                        </td>

                        <!-- Proxy -->
                        <td class="p-4">
                            <button [id]="'home-profile-' + i + '-proxy-btn'"
                                class="w-7 h-7 rounded-md border border-border text-zinc-500 hover:border-primary hover:text-primary transition-colors flex items-center justify-center">
                                <i class="pi pi-plus text-xs"></i>
                            </button>
                        </td>

                        <!-- Tags -->
                        <td class="p-4">
                            <button [id]="'home-profile-' + i + '-tags-btn'"
                                class="w-7 h-7 rounded-md border border-border text-zinc-500 hover:border-primary hover:text-primary transition-colors flex items-center justify-center">
                                <i class="pi pi-plus text-xs"></i>
                            </button>
                        </td>

                        <!-- Notes -->
                        <td class="p-4">
                            @if (profile.metadata?.notes) {
                            <span
                                class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-note-yellow/20 border border-note-yellow/40 rounded text-xs text-note-yellow">
                                <i class="pi pi-pencil text-[10px]"></i>
                                <span class="max-w-[100px] truncate">{{ profile.metadata?.notes }}</span>
                            </span>
                            } @else {
                            <button [id]="'home-profile-' + i + '-notes-btn'"
                                class="w-7 h-7 rounded-md border border-border text-zinc-500 hover:border-primary hover:text-primary transition-colors flex items-center justify-center">
                                <i class="pi pi-plus text-xs"></i>
                            </button>
                            }
                        </td>

                        <!-- Actions -->
                        <td class="p-4">
                            <button [id]="'home-profile-' + i + '-actions-btn'" (click)="deleteProfile(profile, $event)"
                                class="w-7 h-7 rounded-md text-zinc-500 hover:text-error transition-colors flex items-center justify-center">
                                <i class="pi pi-ellipsis-v text-sm"></i>
                            </button>
                        </td>
                    </tr>
                </ng-template>

                <!-- Empty state -->
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7" class="p-8 text-center text-zinc-500">
                            No profiles in this folder
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        } @else {
        <!-- Other tabs placeholder -->
        <div id="home-tab-placeholder" class="flex flex-col items-center justify-center py-16 text-center">
            <div id="home-tab-placeholder-icon"
                class="w-16 h-16 rounded-xl bg-surface border border-border flex items-center justify-center mb-4">
                <i class="pi pi-cog text-2xl text-zinc-500"></i>
            </div>
            <h3 id="home-tab-placeholder-title" class="text-lg font-semibold text-zinc-50 mb-2">{{ activeTab() |
                titlecase }}</h3>
            <p id="home-tab-placeholder-desc" class="text-sm text-zinc-500">Coming soon...</p>
        </div>
        }
    </div>

    <!-- Sticky Paginator at the bottom -->
    @if (profiles().length > 0 && activeTab() === 'profiles') {
    <div id="home-paginator-container" class="bg-surface border-t border-border px-6 py-2 sticky bottom-0 z-10">
        <p-paginator [rows]="rowsPerPage()" [totalRecords]="filteredProfiles().length" [first]="first()"
            [rowsPerPageOptions]="[5, 10, 20]" (onPageChange)="onPaginatorChange($event)" [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} profiles" />
    </div>
    }

    <!-- Bottom Action Bar -->
    @if (selectedProfiles().length > 0) {
    <footer id="home-footer" class="flex items-center justify-between px-6 py-3 border-t border-border bg-surface z-20">
        <div id="home-footer-actions" class="flex items-center gap-2">
            <button id="home-footer-edit-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-zinc-50 hover:border-zinc-400 transition-colors flex items-center justify-center"
                title="Edit">
                <i class="pi pi-pencil"></i>
            </button>
            <button id="home-footer-duplicate-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-zinc-50 hover:border-zinc-400 transition-colors flex items-center justify-center"
                title="Duplicate">
                <i class="pi pi-copy"></i>
            </button>
            <button id="home-footer-move-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-zinc-50 hover:border-zinc-400 transition-colors flex items-center justify-center"
                title="Move to folder">
                <i class="pi pi-folder"></i>
            </button>
            <button id="home-footer-sync-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-zinc-50 hover:border-zinc-400 transition-colors flex items-center justify-center"
                title="Sync">
                <i class="pi pi-sync"></i>
            </button>
            <button id="home-footer-refresh-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-zinc-50 hover:border-zinc-400 transition-colors flex items-center justify-center"
                title="Refresh">
                <i class="pi pi-refresh"></i>
            </button>
            <div class="w-px h-6 bg-border mx-2"></div>
            <button id="home-footer-start-all-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-primary hover:border-primary transition-colors flex items-center justify-center"
                title="Start all">
                <i class="pi pi-play"></i>
            </button>
            <button id="home-footer-stop-all-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-warning hover:border-warning transition-colors flex items-center justify-center"
                title="Stop all">
                <i class="pi pi-pause"></i>
            </button>
            <button id="home-footer-delete-btn"
                class="w-9 h-9 rounded-lg border border-border text-zinc-400 hover:text-error hover:border-error transition-colors flex items-center justify-center"
                title="Delete">
                <i class="pi pi-trash"></i>
            </button>
        </div>
        <span id="home-footer-selected-count" class="text-sm text-zinc-500">{{ selectedProfiles().length }}
            selected</span>
    </footer>
    }
</div>

<!-- Create Profile Dialog -->
<p-dialog id="home-create-dialog" header="Create New Profile" [(visible)]="showCreateDialog" [modal]="true"
    [style]="{ width: '400px' }" [draggable]="false" [resizable]="false">
    <div id="home-create-dialog-content" class="py-2">
        <label for="home-create-dialog-name-input" class="block text-xs font-medium text-zinc-500 mb-2">Profile
            Name</label>
        <input pInputText id="home-create-dialog-name-input" type="text" [ngModel]="newProfileName()"
            (ngModelChange)="newProfileName.set($event)" placeholder="e.g., Work, Personal"
            class="w-full bg-bg border border-border rounded-lg px-4 py-3 text-zinc-50 text-sm focus:border-primary outline-none" />
    </div>
    <ng-template #footer>
        <div id="home-create-dialog-footer" class="flex justify-end gap-3 pt-2">
            <button id="home-create-dialog-cancel-btn" pButton
                class="px-5 py-2.5 bg-surface-hover border border-border rounded-lg text-zinc-50 text-sm cursor-pointer"
                (click)="showCreateDialog.set(false)">Cancel</button>
            <button id="home-create-dialog-submit-btn" pButton
                class="px-5 py-2.5 bg-primary border-none rounded-lg text-bg text-sm font-medium cursor-pointer"
                (click)="createProfile()">Create</button>
        </div>
    </ng-template>
</p-dialog>

<!-- Rename Profile Dialog -->
<p-dialog id="home-rename-dialog" header="Rename Profile" [(visible)]="showRenameDialog" [modal]="true"
    [style]="{ width: '400px' }" [draggable]="false" [resizable]="false">
    <div id="home-rename-dialog-content" class="py-2">
        <label for="home-rename-dialog-name-input" class="block text-xs font-medium text-zinc-500 mb-2">New Name</label>
        <input pInputText id="home-rename-dialog-name-input" type="text" [ngModel]="renameProfileName()"
            (ngModelChange)="renameProfileName.set($event)"
            class="w-full bg-bg border border-border rounded-lg px-4 py-3 text-zinc-50 text-sm focus:border-primary outline-none" />
    </div>
    <ng-template #footer>
        <div id="home-rename-dialog-footer" class="flex justify-end gap-3 pt-2">
            <button id="home-rename-dialog-cancel-btn" pButton
                class="px-5 py-2.5 bg-surface-hover border border-border rounded-lg text-zinc-50 text-sm cursor-pointer"
                (click)="showRenameDialog.set(false)">Cancel</button>
            <button id="home-rename-dialog-submit-btn" pButton
                class="px-5 py-2.5 bg-primary border-none rounded-lg text-bg text-sm font-medium cursor-pointer"
                (click)="renameProfile()">Rename</button>
        </div>
    </ng-template>
</p-dialog>

<!-- Edit Profile Dialog -->
<p-dialog id="home-edit-dialog" header="Edit Profile" [(visible)]="showEditDialog" [modal]="true"
    [style]="{ width: '500px' }" [draggable]="false" [resizable]="false">
    <div id="home-edit-dialog-content" class="py-2 space-y-5">
        <!-- Icon -->
        <div id="home-edit-dialog-icon-section">
            <label class="block text-xs font-medium text-zinc-500 mb-2">Icon</label>
            <div id="home-edit-dialog-icon-options" class="flex flex-wrap gap-2">
                @for (emoji of emojiOptions; track emoji; let i = $index) {
                <button [id]="'home-edit-dialog-emoji-' + i"
                    class="w-10 h-10 rounded-lg border flex items-center justify-center text-xl cursor-pointer transition-all duration-150"
                    [class]="editEmoji() === emoji ? 'bg-primary border-primary' : 'bg-surface-hover border-border hover:border-primary'"
                    (click)="selectEmoji(emoji)">
                    {{ emoji }}
                </button>
                }
            </div>
        </div>

        <!-- Group -->
        <div id="home-edit-dialog-group-section">
            <label class="block text-xs font-medium text-zinc-500 mb-2">Group</label>
            <div id="home-edit-dialog-group-options" class="flex flex-wrap gap-2">
                @for (group of groupOptions; track group; let i = $index) {
                <button [id]="'home-edit-dialog-group-' + i"
                    class="px-3 py-2 rounded-lg border text-sm cursor-pointer transition-all duration-150"
                    [class]="editGroup() === group ? 'bg-primary border-primary text-bg' : 'bg-surface-hover border-border text-zinc-400 hover:border-primary'"
                    (click)="selectGroup(group)">
                    {{ group }}
                </button>
                }
            </div>
        </div>

        <!-- Shortcut -->
        <div id="home-edit-dialog-shortcut-section">
            <label class="block text-xs font-medium text-zinc-500 mb-2">Keyboard Shortcut</label>
            <div id="home-edit-dialog-shortcut-options" class="flex flex-wrap gap-2">
                @for (num of shortcutOptions; track num; let i = $index) {
                <button [id]="'home-edit-dialog-shortcut-' + i"
                    class="w-10 h-10 rounded-lg border flex items-center justify-center text-sm font-mono cursor-pointer transition-all duration-150"
                    [class]="editShortcut() === num ? 'bg-primary border-primary text-bg' : 'bg-surface-hover border-border text-zinc-400 hover:border-primary'"
                    (click)="selectShortcut(num)">
                    âŒ˜{{ num }}
                </button>
                }
            </div>
        </div>

        <!-- Browser -->
        <div id="home-edit-dialog-browser-section">
            <label class="block text-xs font-medium text-zinc-500 mb-2">Default Browser</label>
            <div id="home-edit-dialog-browser-options" class="flex flex-wrap gap-2">
                @for (browser of availableBrowsers(); track browser; let i = $index) {
                <button [id]="'home-edit-dialog-browser-' + i"
                    class="px-3 py-2 rounded-lg border text-sm cursor-pointer transition-all duration-150 flex items-center gap-2"
                    [class]="editBrowser() === browser ? 'bg-primary border-primary text-bg' : 'bg-surface-hover border-border text-zinc-400 hover:border-primary'"
                    (click)="selectBrowser($any(browser))">
                    <i [class]="'pi ' + browserInfo[browser].icon"></i>
                    {{ browserInfo[browser].name }}
                </button>
                }
            </div>
        </div>

        <!-- Notes -->
        <div id="home-edit-dialog-notes-section">
            <label for="home-edit-dialog-notes-input" class="block text-xs font-medium text-zinc-500 mb-2">Notes</label>
            <textarea id="home-edit-dialog-notes-input" [ngModel]="editNotes()" (ngModelChange)="editNotes.set($event)"
                placeholder="What is this profile for?" rows="2"
                class="w-full bg-bg border border-border rounded-lg px-4 py-3 text-zinc-50 text-sm focus:border-primary outline-none resize-none"></textarea>
        </div>
    </div>
    <ng-template #footer>
        <div id="home-edit-dialog-footer" class="flex justify-end gap-3 pt-2">
            <button id="home-edit-dialog-cancel-btn" pButton
                class="px-5 py-2.5 bg-surface-hover border border-border rounded-lg text-zinc-50 text-sm cursor-pointer"
                (click)="showEditDialog.set(false)">Cancel</button>
            <button id="home-edit-dialog-submit-btn" pButton
                class="px-5 py-2.5 bg-primary border-none rounded-lg text-bg text-sm font-medium cursor-pointer"
                (click)="saveProfileEdit()">Save</button>
        </div>
    </ng-template>
</p-dialog>