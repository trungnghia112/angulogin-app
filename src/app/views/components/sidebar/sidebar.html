<aside id="sidebar-container" class="flex flex-col h-screen w-60 bg-surface-900 border-r border-surface-700">
    <!-- Feature Header - matches header height -->
    <div id="sidebar-header"
        class="flex items-center justify-between px-4 h-(--spacing-header) shrink-0 border-b border-surface-700">
        <span id="sidebar-header-title" class="text-base font-semibold text-surface-0">Browsers</span>
        <div id="sidebar-header-actions" class="flex items-center gap-1">
            <button id="sidebar-header-settings-btn"
                class="w-7 h-7 rounded-md flex items-center justify-center text-surface-0 hover:text-surface-300 hover:bg-surface-800 transition-colors"
                (click)="openProfilesDirectoryDialog()" title="Profiles Directory">
                <i class="pi pi-cog text-sm"></i>
            </button>
            <button id="sidebar-header-add-btn"
                class="w-7 h-7 rounded-md flex items-center justify-center text-surface-0 hover:text-surface-300 hover:bg-surface-800 transition-colors"
                (click)="onAddFolder()" title="Add folder">
                <i class="pi pi-plus text-sm"></i>
            </button>
        </div>
    </div>

    <!-- Folders Header -->
    <div id="sidebar-folders-header" class="px-4 py-2">
        <span id="sidebar-folders-title"
            class="text-xs font-semibold text-surface-0 uppercase tracking-wide">Folders</span>
    </div>

    <!-- Folders List -->
    <nav id="sidebar-folders-list" class="flex-1 overflow-y-auto px-2">
        @for (folder of folders(); track folder.id; let i = $index) {
        <button [id]="'sidebar-folder-' + i"
            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg mb-0.5 transition-all duration-150" [class]="selectedFolderId() === folder.id 
          ? 'bg-surface-800 text-surface-0' 
          : 'text-surface-400 hover:text-surface-200 hover:bg-surface-800/50'" (click)="selectFolder(folder.id)">
            <i [class]="'pi ' + getFolderIcon(folder) + ' text-base'" [style.color]="getFolderColor(folder)"></i>
            <span class="text-sm font-medium truncate flex-1 text-left">{{ folder.name }}</span>
            @if (folder.profileCount !== undefined) {
            <span class="text-xs text-surface-600">{{ folder.profileCount }}</span>
            }
        </button>
        }
    </nav>

    <!-- Bottom Actions -->
    <div id="sidebar-bottom" class="border-t border-surface-700 p-3">
        <div id="sidebar-bottom-actions" class="flex items-center justify-between">
            <button id="sidebar-settings-btn"
                class="w-8 h-8 rounded-md flex items-center justify-center text-surface-0 hover:text-surface-300 hover:bg-surface-800 transition-colors"
                (click)="onSettings()" title="Settings">
                <i class="pi pi-cog text-sm"></i>
            </button>
            <button id="sidebar-trash-btn"
                class="w-8 h-8 rounded-md flex items-center justify-center text-surface-0 hover:text-surface-300 hover:bg-surface-800 transition-colors"
                title="Trash">
                <i class="pi pi-trash text-sm"></i>
            </button>
            <button id="sidebar-export-btn"
                class="w-8 h-8 rounded-md flex items-center justify-center text-surface-0 hover:text-surface-300 hover:bg-surface-800 transition-colors"
                title="Export">
                <i class="pi pi-download text-sm"></i>
            </button>
        </div>
    </div>
</aside>

<!-- Profiles Directory Dialog -->
<p-dialog id="sidebar-profiles-dir-dialog" header="Profiles Directory" [visible]="showProfilesDirectoryDialog()"
    (visibleChange)="showProfilesDirectoryDialog.set($event)" [modal]="true" [style]="{ width: '480px' }"
    [draggable]="false" [resizable]="false">
    <div id="sidebar-profiles-dir-dialog-content" class="py-2 space-y-4">
        <p class="text-sm text-surface-400">
            Set the directory where your Chrome profiles are stored. This path will be used to scan and manage your
            browser profiles.
        </p>
        <div>
            <label for="sidebar-profiles-dir-input" class="block text-xs font-medium text-surface-0 mb-2">Directory
                Path</label>
            <div class="flex items-center gap-2">
                <input pInputText id="sidebar-profiles-dir-input" type="text" [ngModel]="profilesDirectoryPath()"
                    (ngModelChange)="profilesDirectoryPath.set($event)"
                    placeholder="/Volumes/ExternalDrive/ChromeProfiles"
                    class="flex-1 bg-surface-950 border border-surface-700 rounded-lg px-4 py-3 text-surface-0 text-sm focus:border-primary outline-none" />
                <button id="sidebar-profiles-dir-browse-btn"
                    class="w-10 h-10 rounded-lg border border-surface-700 text-surface-400 hover:text-surface-0 hover:border-primary transition-colors flex items-center justify-center"
                    (click)="browseFolder()" title="Browse folder">
                    <i class="pi pi-folder-open"></i>
                </button>
            </div>
        </div>
        <div class="bg-surface-800/50 rounded-lg p-3 border border-surface-700">
            <div class="flex items-center gap-2 text-xs text-surface-0">
                <i class="pi pi-info-circle"></i>
                <span>Example: <code class="text-surface-400">/Users/john/ChromeProfiles</code></span>
            </div>
        </div>
    </div>
    <ng-template #footer>
        <div id="sidebar-profiles-dir-dialog-footer" class="flex justify-end gap-3 pt-2">
            <button id="sidebar-profiles-dir-cancel-btn" pButton
                class="px-5 py-2.5 bg-surface-800 border border-surface-700 rounded-lg text-surface-0 text-sm cursor-pointer"
                (click)="showProfilesDirectoryDialog.set(false)">Cancel</button>
            <button id="sidebar-profiles-dir-save-btn" pButton
                class="px-5 py-2.5 bg-primary border-none rounded-lg text-bg text-sm font-medium cursor-pointer"
                (click)="saveProfilesDirectory()">Save</button>
        </div>
    </ng-template>
</p-dialog>